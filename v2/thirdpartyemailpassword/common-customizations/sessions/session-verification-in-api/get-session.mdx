---
id: get-session
title: Using the getSession function
hide_title: true
---


<!-- COPY DOCS -->
<!-- ./session/common-customizations/sessions/session-verification-in-api/get-session.mdx -->

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs"
import TabItem from '@theme/TabItem';


// add try catch, add all possible errors and in comments decribe how to handle them, also add the other two ways of doing session verification.

# Session Verification using `getSession`

If you need to verify a session in your API, you should be using the [verifySession](./verify-session) middleware whenever possible, but, if you need session verification in the middle of your API logic, then use `getSession` as shown below.

## Requiring an active session

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
let Session = require("supertokens-node/recipe/session");

// highlight-start
app.post("/like-comment", (req, res) => {
    
    // this will contain the session object post verification
    let session

    try {
        session = await Session.getSession(req, res);
    } catch (err) {
        if (err.type === Session.Error.TRY_REFRESH_TOKEN) {
            
            // In this case, the session is still valid, only the access token has expired.
            // A new access and refresh token can be generated by calling the /auth/session/refresh API.

        } else if (err.type === Session.Error.UNAUTHORISED) {

            // In this case the session is not vaild and the cookies will be cleared from the response.

        } else {
            throw err
        }
    }
    
    let userId = session.getUserId(); 
// highlight-end
    //....
});
```
</TabItem>
</BackendSDKTabs>


## Optional session verification

Sometimes, you want an API to be accessible even if there is no session. In that case, you can use the `sessionRequired` flag:

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
let Session = require("supertokens-node/recipe/session");

app.post("/like-comment",(req, res) => {

    let session
    
    try {
        session = await Session.getSession(req, res, {sessionRequired: false})
    } catch (err) {
        if (err.type === Session.Error.TRY_REFRESH_TOKEN) {
            
            // In this case, the session is still valid, only the access token has expired.
            // A new access and refresh token can be generated by calling the /auth/session/refresh API.

        } else {
            throw err
        }
    }
    
    if (session !== undefined) {
        let userId = session.getUserId();
    } else {
        // user is not logged in...
    }
});
```
</TabItem>
</BackendSDKTabs>
