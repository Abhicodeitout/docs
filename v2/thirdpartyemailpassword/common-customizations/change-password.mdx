---
id: change-password
title: Change a User's Password
hide_title: true
---

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';

# Change a User's Password

In this section we will go over how you can create a route on your backend which can change a user's password.

The user will have to enter their old password and the password they would like to update it to. If the old password is valid the user's profile will now be updated with the new password.

## Step 1: Creating the `/change-password` route
- You will first need to create a route on your backend which is protected with the `verifySession` Middleware
- The `verifySession` middleware will ensure that only an authenticated user can access the protected route.
- In this example `/change-password` will be the route on your backend which will be used to update a users password.

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ThirdPartyEmailPassword = require("supertokens-node/recipe/thirdpartyemailpassword");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.post("/change-password", verifySession(), async (req, res) => {

})

```
</TabItem>
</BackendSDKTabs>


## Step 2: Use the `session` Object to retrive the user's info and check if the old password is a valid credential

- You can now use the `getUserId` function exposed by the `session` object to retrive the logged in user's `userId`.
- The user's profile can be retrived using the `getUserById` function.
- You can now call the `signIn` function and check if the old password is a valid credential

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ThirdPartyEmailPassword = require("supertokens-node/recipe/thirdpartyemailpassword");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.post("/change-password", verifySession(), async (req, res) => {

    // get the supertokens session object from the req
    let session = req.session

    // retrive the new password from the request body
    let updatedPassword = req.body.password

    // get the users Id from the session
    let userId = session.getUserId()

    // call signin to check that input password is correct

    let isPasswordValid = await ThirdPartyEmailPassword.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }

})

```
</TabItem>
</BackendSDKTabs>

## Step 3: Revoke all sessions associated with the user (optional)

- You can now revoke all sessions created by the user by calling the `revokeAllSessionsForUser` function.

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ThirdPartyEmailPassword = require("supertokens-node/recipe/thirdpartyemailpassword");
let Session = require("supertokens-node/recipe/session");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.get("/change-password", verifySession(), async (req, res) => {

    // get the session information from the req
    let session = req.session

    let oldPassword = req.body.oldPassword
    let updatedPassword = req.query.newPassword

    // get the users Id from the req.session
    let userId = session.getUserId()

    // get the signed in user's email from the getUserById function
    let userInfo = await ThirdPartyEmailPassword.getUserById(userId)

    // call signin to check that input password is correct

    let isPasswordValid = await ThirdPartyEmailPassword.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }

    // update the user's password using updateEmailOrPassword
    let response = await ThirdPartyEmailPassword.updateEmailOrPassword({
        userId,
        password: updatedPassword
    })

    // revoke all sessions for the user
    await Session.revokeAllSessionsForUser(userId)

    res.send({
        response
    })

})

```
</TabItem>
</BackendSDKTabs>