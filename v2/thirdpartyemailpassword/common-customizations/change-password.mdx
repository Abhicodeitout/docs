---
id: change-password
title: Change a User's Password
hide_title: true
---

<!-- COPY DOCS -->
<!-- ./thirdpartyemailpassword/common-customizations/change-password.mdx -->

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import BackendSDKCasing from "/src/components/BackendSDKCasing"
import TabItem from '@theme/TabItem';

# Change a User's Password

:::caution
SuperTokens does not provide the UI for users to change/update their password, you will need to create the UI and setup a route on your backend to have this functionality.
:::

In this section we will go over how you can create a route on your backend which can update a user's password. Calling this route will check if the old password is valid and update the user's profile with the new password.

## Step 1: Creating the `/change-password` route
- You will need to create a route on your backend which is protected by the session verification middleware, this will ensure that only a authenticated user can access the protected route.
- To learn more about how to use the session verfication middleware for other frameworks click [here](verify-session)

<BackendSDKTabs>

<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

// highlight-start
app.post("/change-password", verifySession(), async (req, res) => {

})

// highlight-end
```
</TabItem>

<TabItem value="go">

```go
// highlight-start
// the following example uses net/http
func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {
    
}
// highlight-end
```

</TabItem>


<TabItem value="python">

```python
# the following example uses flask
from supertokens_python.recipe.session.framework.flask import verify_session

# highlight-start
@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():
# highlight-end
```

</TabItem>

</BackendSDKTabs>


## Step 2: Validate and update the user's password

- You can now use the `getUserId` function exposed by the `session` object to retrive the logged in user's `userId`.
- The user's profile can be retrived using the `getUserById` function.
- Use `signIn` function and check if the old password is valid
- You can update the user's password with the `updateEmailOrPassword` function. 

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.post("/change-password", verifySession(), async (req, res) => {

    // highlight-start
    // get the supertokens session object from the req
    let session = req.session

    // retrive the old password from the request body
    let oldPassword = req.body.oldPassword

    // get the user's Id from the session
    let userId = session.getUserId()

    // get the signed in user's email from the getUserById function
    let userInfo = await ^{recipeNameCapitalLetters}.getUserById(userId)

    // call signin to check that input password is correct
    let isPasswordValid = await ^{recipeNameCapitalLetters}.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }

    // update the user's password using updateEmailOrPassword

    let response = await ^{recipeNameCapitalLetters}.updateEmailOrPassword({
        userId,
        password: updatedPassword
    })
    
    res.send({
        status: response.status
    })
    // highlight-end

})

```
</TabItem>

<TabItem value="go">

```go

func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

type ResponseBody struct {
    OldPassword string
    NewPassword string
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {

	// retrieve the session object as shown below
	sessionContainer := session.GetSessionFromRequestContext(r.Context())

	// retrive the old password from the request body
	var response ResponseBody
	err := json.NewDecoder(r.Body).Decode(&response)
	if err != nil {
		http.Error(w, err.Error(), http.StatusBadRequest)
		return
	}

	// get the userId from the session
	userID := sessionContainer.GetUserID()

	// get the signed in user's email from the getUserById function
	userInfo, err := ^{rid}.GetUserById(userID)
	if err != nil {
		// TODO: Handle error
		return
	}

	// call signin to check that the input is correct
	isPasswordValid, err := ^{rid}.SignIn(userInfo.Email, response.OldPassword)
	if err != nil {
		// TODO: Handle error
		return
	}

    // highlight-start
	if isPasswordValid.OK == nil {
		// TODO: Handle error
		return
	}

    response, err = ^{rid}.UpdateEmailOrPassword(userID, &userInfo.Email, &response.NewPassword)
	if err != nil {
		// TODO: Handle error
		return
	}
    // highlight-end

    resp := make(map[string]string)
    if response.OK != nil { 
        resp["status"] = "OK"
    } else {
        resp["status"] = "Could not update"
    }
	jsonResp, err := json.Marshal(resp)
	if err != nil {
		log.Fatalf("Error happened in JSON marshal. Err: %s", err)
	}
	w.Write(jsonResp)
}

```
</TabItem>

<TabItem value="python">

```python
from supertokens_python.recipe.session.framework.flask import verify_session
from supertokens_python.recipe.^{rid}.syncio import get_user_by_id, sign_in

@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():

    # highlight-start
    session_ = g.supertokens
    
    # get the userId from the session object
    user_id = session_.get_user_id()

    # get the signed in user's email from the getUserById function
    users_info = get_user_by_id(user_id)
    
    # call signin to check that the input password is correct
    isPasswordValid = sign_in(users_info.email, request.json["oldPassword"])

    if isPasswordValid.status != "OK":
        return isPasswordValid.status
    
    # update the users password
    response = update_email_or_password(user_id, password=request.json["newPassword"])
    return response.status
    # highlight-end

```
</TabItem>
</BackendSDKTabs>

## Step 3: Revoke all sessions associated with the user (optional)

- You can now revoke all sessions created by the user by calling the `revokeAllSessionsForUser` function.

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let Session = require("supertokens-node/recipe/session");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.get("/change-password", verifySession(), async (req, res) => {

    // get the session information from the req
    let session = req.session

    let oldPassword = req.body.oldPassword
    let updatedPassword = req.query.newPassword

    // get the users Id from the req.session
    let userId = session.getUserId()

    // get the signed in user's email from the getUserById function
    let userInfo = await ^{recipeNameCapitalLetters}.getUserById(userId)

    // call signin to check that input password is correct

    let isPasswordValid = await ^{recipeNameCapitalLetters}.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }

    // update the user's password using updateEmailOrPassword
    let response = await ^{recipeNameCapitalLetters}.updateEmailOrPassword({
        userId,
        password: updatedPassword
    })

    // highlight-start
    // revoke all sessions for the user
    await Session.revokeAllSessionsForUser(userId)

    // revoke the current user's session, we do this to remove the auth cookies, logging out the user on the frontend.
    await Session.revokeSession(session.getHandle())
    //highlight-end

    res.send({
        status: response.status
    })

})

```
</TabItem>

<TabItem value="go">

```go

func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

type ResponseBody struct {
    OldPassword string
    NewPassword string
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {

	// retrieve the session object as shown below
	sessionContainer := session.GetSessionFromRequestContext(r.Context())

	// retrive the old password from the request body
	var response ResponseBody
	err := json.NewDecoder(r.Body).Decode(&response)
	if err != nil {
		http.Error(w, err.Error(), http.StatusBadRequest)
		return
	}

	// get the userId from the session
	userID := sessionContainer.GetUserID()

	// get the signed in user's email from the getUserById function
	userInfo, err := ^{rid}.GetUserById(userID)
	if err != nil {
		// TODO: Handle error
		return
	}

	// call signin to check that the input is correct
	isPasswordValid, err := ^{rid}.SignIn(userInfo.Email, response.OldPassword)
	if err != nil {
		// TODO: Handle error
		return
	}

	if isPasswordValid.OK == nil {
		// TODO: IHandle nvalid oldPassword
		return
	}

	_, err = ^{rid}.UpdateEmailOrPassword(userID, &userInfo.Email, &response.NewPassword)
	if err != nil {
		// TODO: Handle error
		return
	}

    // highlight-start

    // revoke all sessions for the user
	_, err = session.RevokeAllSessionsForUser(userID)
	if err != nil {
		// TODO: Handle error
	}

    // revoke the user's current session, we do this to remove the auth cookies, logging out the user on the frontend
    _, err = session.RevokeSession(userID)
	if err != nil {
		// TODO: Handle error
	}

    // highlight-end

	resp := make(map[string]string)
    if response.OK != nil { 
        resp["status"] = "OK"
    } else {
        resp["status"] = "Could not update"
    }
	jsonResp, err := json.Marshal(resp)
	if err != nil {
		log.Fatalf("Error happened in JSON marshal. Err: %s", err)
	}
	w.Write(jsonResp)
}

```
</TabItem>

<TabItem value="python">

```python
from supertokens_python.recipe.session.framework.flask import verify_session
from supertokens_python.recipe.^{rid}.syncio import get_user_by_id, sign_in, update_email_or_password
from supertokens_python.recipe.session.syncio import revoke_all_sessions_for_user, revoke_session

@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():
    session_ = g.supertokens
    
    # get the userId from the session object
    user_id = session_.get_user_id()

    # get the signed in user's email from the getUserById function
    users_info = get_user_by_id(user_id)
    
    # call signin to check that the input password is correct
    isPasswordValid = sign_in(users_info.email, request.json["oldPassword"])

    if isPasswordValid.status != "OK":
        return isPasswordValid.status
    
    # update the users password
    response = update_email_or_password(user_id, password=request.json["newPassword"])

    # highlight-start
    # revoke all sessions for the user
    revoke_all_sessions_for_user(user_id)
    
    # revoke the user's current session, we do this to remove the auth cookies, logging out the user on the frontend
    revoke_session(session_.get_handle())
    # highlight-end
    return response.status

```
</TabItem>

</BackendSDKTabs>