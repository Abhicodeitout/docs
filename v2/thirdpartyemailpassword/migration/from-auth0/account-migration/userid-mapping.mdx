---
id: userid-mapping
title: User ID Mapping
hide_title: true
---

# User ID Mapping

If you have stored a user's Auth0 userId in your database and you use that information for some feature, you will need to map the user's Auth0 userId to their SuperTokens userId to be able to continue to use that feature.

In this section we will go over the functions used to set and retrive  `userId` data used in the [Modifications to login](./modifications-to-login#implementation) section and how to override the necessary SuperTokens functions to ensure your app continues to function.

## Implementation

We will need the following two functions:

- `setAuth0ToSuperTokensUserIdMapping()`
- `getAuth0ToSuperTokensUserIdMapping()`

```jsx

function setAuth0ToSuperTokensUserIdMapping({ auth0UserId, supertokensUserId }){
    // add the userId mapping to your data store
}

function getAuth0ToSuperTokensUserIdMapping( userId ){
    // get the userID Mapping from your data store
    // getUserIDMappingFromDataStore is a function defined by you 
    let allUsersIDMapping = getUserIdMappingFromDataStore()
    
    // get mapped userIds if the input userId exits in your data store
    // getUserIdMappingIfExists is a function defined by you
    let userIdMapping = getUserIdMappingIfExists(allUsersIDMapping)

    // if input userId exists get the mapped user data
    if( userIdMapping !== undefined ){

        return ({ auth0UserId: userIdMapping.auth0UserId, supertokensUserId: userIdMapping.supertokensUserId })
    }

    return undefined
}

```

You will now need to modify SuperTokens functions which userId to ensure that the correct userId is used.

### Overriding all functions on the backend which take `userId` as input or return `userId` in their response:

- If a user has a Auth0 `userId` mapped to an SuperTokens `userId`, then: 
  - All function which take `userId` as input need to replace the Auth0 `userId` in the input with the associated SuperTokens `userId`. 
  - All function which return `userId` in their response need to replace the SuperTokens `userId` in the response with the associated Auth0 `userId`.

You can learn more about User ID mapping and the associated functions in the next [section](./userid-mapping)

```jsx title="Nodejs"
ThirdPartyEmailPassword.init({
    override: {
        functions: (orignalImpl) => {
            return {
                ...orignalImpl,
                signInUp: async function (input) { ... },
                signIn: async function (input) { ... },
                getUsersByEmail: async function (input) {

                    let users = await orignalImpl.getUsersByEmail(input)
                    // if the ST userId in reponse is mapped to a Auth0 userId return the mapped userId object, else return undefined
                    for (let i = 0; i < users.length; i++) {

                        let userIdMappingInfo = getAuth0ToSuperTokensUserIdMapping(users[i].id)

                        if(userIdMappingInfo !== undefined){
                           users[i].id = userIdMappingInfo.auth0UserId 
                        }
                        
                    }
                    return users;
                },
                getUserByThirdPartyInfo: async function (input) {

                    let response = await orignalImpl.getUserByThirdPartyInfo(input)

                    // if the ST userId in reponse is mapped to a Auth0 userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getAuth0ToSuperTokensUserIdMapping(response.id)

                    if( userIdMappingInfo !== undefined ){
                        response.id = userIdMappingInfo.auth0UserId
                    }
                    return response;
                },
                getUserById: async function (input) {

                    // if the ST userId in reponse is mapped to a Auth0 userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getAuth0ToSuperTokensUserIdMapping(response.id)

                    if( userIdMappingInfo !== undefined ){
                        
                        // call orignal implementation with the mapped SuperTokens userId
                        let response = await orignalImpl.getUserById({ userId: userIdMappingInfo.supertokensUserId })

                        // set Auth0 userId in the response
                        response.id = userIdMappingInfo.auth0UserId

                        return response;
                    }
                    return await orignalImpl.getUserById(input)

                    
                },
                createResetPasswordToken: async function (input) {
                    
                    // if the ST userId in reponse is mapped to a Auth0 userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getAuth0ToSuperTokensUserIdMapping(response.id)

                    if( userIdMappingInfo !== undefined ){
                        
                        // call orignal implementation with the mapped SuperTokens userId
                        let response = await orignalImpl.createResetPasswordToken({ userId: userIdMappingInfo.supertokensUserId })

                        return response;
                    }

                    return await orignalImpl.createResetPasswordToken(input)
                },
                updateEmailOrPassword: async function (input) {

                    // if the ST userId in reponse is mapped to a Auth0 userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getAuth0ToSuperTokensUserIdMapping(response.id)

                    if( userIdMappingInfo !== undefined ){
                        
                        // call orignal implementation with the mapped SuperTokens userId
                        input.userId = userIdMappingInfo.supertokensUserId

                        return await orignalImpl.updateEmailOrPassword(input)
                    }

                    return await orignalImpl.createResetPasswordToken(input)
                }
            }
        }
    },
})
```
