---
id: userid-mapping
title: User ID Mapping
hide_title: true
---

# User ID Mapping

:::tip
If you have not stored your user's Auth0 userId in your database you can **ignore** this section.
:::

If you have stored a user's Auth0 userId in your database and you use that information for some feature, you will need to map the user's Auth0 userId to their SuperTokens userId to be able to continue to use that feature.

In this section we will go over the functions used to set and retrive `userId` data used in the [Modifications to login](./modifications-to-login) section, and, how to override the necessary SuperTokens functions to ensure your app continues to function.

## Implementation

We will need the following two functions:

- `setUserIdMapping()`
- `getUserIdMapping()`

```jsx
// The following function is used in login functions in the modifications to login section
function setUserIdMapping({ auth0UserId, supertokensUserId }){
    // add the userId mapping to your data store
}

function getUserIdMapping( input: { auth0UserId | supertokensUserId } ){
    // get the userID Mapping from your data store
    // getUserIDMappingFromDataStore is a function defined by you

    let allUsersIDMapping = getUserIdMappingFromDataStore()
    
    // get mapped userIds if the input userId exits in your data store
    // getUserIdMappingIfExists is a function defined by you
    let userIdMapping = getUserIdMappingIfExists(allUsersIDMapping, input)

    // if input userId exists get the mapped user data
    if( userIdMapping !== undefined ){

        return ({ auth0UserId: userIdMapping.auth0UserId, supertokensUserId: userIdMapping.supertokensUserId })
    }

    return undefined
}

```

You will now need to modify the SuperTokens functions which handle userId to ensure that the correct userId is used.

### Overriding all functions on the backend which take `userId` as input or return `userId` in their response:

- If a user has a Auth0 `userId` mapped to an SuperTokens `userId`, then use then use the Supertokens `userId` in the function and set the Auth0  `userId` in the response.

The following functions need to be modified so that the correct  `userId` is used:
- `getUsersByEmail`
- `getUserByThirdPartyInfo`
- `getUserById`
- `createResetPasswordToken`
- `updateEmailOrPassword`


```jsx title="Nodejs"
ThirdPartyEmailPassword.init({
    override: {
        functions: (orignalImpl) => {
            return {
                ...orignalImpl,
                signInUp: async function (input) { ... },
                signIn: async function (input) { ... },
                getUsersByEmail: async function (input) {

                    let users = await orignalImpl.getUsersByEmail(input)
                    // if the ST userId in reponse is mapped to a Auth0 userId return the mapped userId object, else return undefined
                    for (let i = 0; i < users.length; i++) {

                        let userIdMappingInfo = getUserIdMapping({supertokensUserId: users[i].id})

                        if(userIdMappingInfo !== undefined){
                           users[i].id = userIdMappingInfo.auth0UserId 
                        }
                        
                    }
                    return users;
                },
                getUserByThirdPartyInfo: async function (input) {

                    let response = await orignalImpl.getUserByThirdPartyInfo(input)

                    // if the ST userId in reponse is mapped to a Auth0 userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getUserIdMapping({ supertokensUserId: response.id})

                    if( userIdMappingInfo !== undefined ){
                        response.id = userIdMappingInfo.auth0UserId
                    }
                    return response;
                },
                getUserById: async function (input) {

                    // if the Auth0 userId in input is mapped to a SuperTokens userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getUserIdMapping({ auth0UserId: input.userId})

                    if( userIdMappingInfo !== undefined ){
                        
                        // call orignal implementation with the mapped SuperTokens userId
                        let response = await orignalImpl.getUserById({ userId: userIdMappingInfo.supertokensUserId })

                        // set Auth0 userId in the response
                        response.id = userIdMappingInfo.auth0UserId

                        return response;
                    }
                    return await orignalImpl.getUserById(input)

                    
                },
                createResetPasswordToken: async function (input) {
                    
                     // if the Auth0 userId in input is mapped to a SuperTokens userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getUserIdMapping({ auth0UserId: input.userId})

                    if( userIdMappingInfo !== undefined ){
                        
                        // call orignal implementation with the mapped SuperTokens userId
                        let response = await orignalImpl.createResetPasswordToken({ userId: userIdMappingInfo.supertokensUserId })

                        return response;
                    }

                    return await orignalImpl.createResetPasswordToken(input)
                },
                updateEmailOrPassword: async function (input) {

                     // if the Auth0 userId in input is mapped to a SuperTokens userId return the mapped userId object, else return undefined
                    let userIdMappingInfo = getUserIdMapping({ auth0UserId: input.userId})

                    if( userIdMappingInfo !== undefined ){
                        
                        // call orignal implementation with the mapped SuperTokens userId
                        input.userId = userIdMappingInfo.supertokensUserId

                        return await orignalImpl.updateEmailOrPassword(input)
                    }

                    return await orignalImpl.createResetPasswordToken(input)
                }
            }
        }
    },
})
```
