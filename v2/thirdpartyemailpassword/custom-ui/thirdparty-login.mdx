---
id: thirdparty-login
title: Social / SSO login
hide_title: true
---

<!-- COPY DOCS -->
<!-- ./thirdpartyemailpassword/custom-ui/thirdparty-login.mdx -->

import FrontendCustomUITabs from "/src/components/tabs/FrontendCustomUITabs"
import TabItem from '@theme/TabItem';
import NpmOrScriptTabs from "/src/components/tabs/NpmOrScriptTabs"
import AppInfoForm from "/src/components/appInfoForm"

# Social / SSO login

There are different flows that the third party login provider may support:
- _**Flow 1)**_ Via authorisation code (one time use code) - for web and mobile apps. 
    - _**a)**_ If you have configred the client secret on the backend:
        - The frontend sends the auth code to the backend, the backend exchanges that with the provided client secret to get the access token. The access token is then used to fetch user info and log them in.
    - _**b)**_ If you have **not** provided the client secret on the backend:
        - The backend uses PKCE flow to exchange the auth code with the user's access token. The access token is then used to fetch user info and log them in.
- _**Flow 2)**_ Via OAuth / access tokens - for mobile apps.
    - The access token is available on the frontend and is sent to the backend. SuperTokens then fetches user info using the access token and logs them in.

:::note
The same flow applies during sign up and sign in. If the user is signing up, the `createdNewUser` boolean on the frontend and backend will be `true` (as the result of the sign in up API call).
:::

<FrontendCustomUITabs>
<TabItem value="web">

## Flow 1a

### Step 1) Redirecting to social / SSO provider

The first step is to fetch the URL on which the user will be authenticated. This can be done by querying the backend API exposed by SuperTokens (as shown below). The backend SDK automatically appends the right query params to the URL (like scope, client ID etc). 

After we get the URL, we simply redirect the user there. In the code below, we will take an example of login with Google:

<NpmOrScriptTabs>
<TabItem value="npm">

```tsx
import { getAuthorisationURLWithQueryParamsAndSetState } from "supertokens-web-js/recipe/^{codeImportRecipeName}";

async function googleSignInClicked() {
    try {
        const authUrl = await getAuthorisationURLWithQueryParamsAndSetState({
            providerId: "google",

            // This is where Google should redirect the user back after login or error.
            // This URL goes on the Google's dashboard as well.
            authorisationURL: "http://localhost:3000/auth/callback/google",
        });

        /*
        Example value of authUrl: https://accounts.google.com/o/oauth2/v2/auth/oauthchooseaccount?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email&access_type=offline&include_granted_scopes=true&response_type=code&client_id=1060725074195-kmeum4crr01uirfl2op9kd5acmi9jutn.apps.googleusercontent.com&state=5a489996a28cafc83ddff&redirect_uri=https%3A%2F%2Fsupertokens.io%2Fdev%2Foauth%2Fredirect-to-app&flowName=GeneralOAuthFlow
        */

        // we redirect the user to google for auth.
        window.location.assign(authUrl);
    } catch (err: any) {
        if (err.isSuperTokensGeneralError === true) {
            // this may be a custom error message sent from the API by you.
            window.alert(err.message);
        } else {
            window.alert("Oops! Something went wrong.");
        }
    }
}
```

</TabItem>
<TabItem value="script">

```tsx
import supertokens^{recipeNameCapitalLetters} from "supertokens-web-js-script/recipe/^{codeImportRecipeName}";
async function googleSignInClicked() {
    try {
        const authUrl = await supertokens^{recipeNameCapitalLetters}.getAuthorisationURLWithQueryParamsAndSetState({
            providerId: "google",

            // This is where Google should redirect the user back after login or error.
            // This URL goes on the Google's dashboard as well.
            authorisationURL: "http://localhost:3000/auth/callback/google",
        });

        /*
        Example value of authUrl: https://accounts.google.com/o/oauth2/v2/auth/oauthchooseaccount?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email&access_type=offline&include_granted_scopes=true&response_type=code&client_id=1060725074195-kmeum4crr01uirfl2op9kd5acmi9jutn.apps.googleusercontent.com&state=5a489996a28cafc83ddff&redirect_uri=https%3A%2F%2Fsupertokens.io%2Fdev%2Foauth%2Fredirect-to-app&flowName=GeneralOAuthFlow
        */

        // we redirect the user to google for auth.
        window.location.assign(authUrl);
    } catch (err: any) {
        if (err.isSuperTokensGeneralError === true) {
            // this may be a custom error message sent from the API by you.
            window.alert(err.message);
        } else {
            window.alert("Oops! Something went wrong.");
        }
    }
}
```

</TabItem>
</NpmOrScriptTabs>

### Step 2) Handling the auth callback on your frontend

Once the third party provider redirects your user back to your app, you need to consume the information to sign in the user. This requires you to:
- Setup a route in your app that will handle this callback. We recommend something like `http://localhost:3000/auth/callback/google` (for Google). Regardless of what you make this path, remember to use that same path when calling the `getAuthorisationURLWithQueryParamsAndSetState` function in the first step.

- On that route, call the following function on page load

    <NpmOrScriptTabs>
    <TabItem value="npm">

    ```tsx
    import { ^{webjsThirdPartySignInUp} } from "supertokens-web-js/recipe/^{codeImportRecipeName}";

    async function handleGoogleCallback() {
        try {
            const response = await ^{webjsThirdPartySignInUp}();

            if (response.status === "OK") {
                console.log(response.user)
                if (response.createdNewUser) {
                    // sign up successful
                } else {
                    // sign in successful
                }
                window.location.assign("/home");
            } else {
                // SuperTokens requires that the third party provider
                // gives an email for the user. If that's not the case, sign up / in
                // will fail.

                // As a hack to solve this, you can override the backend functions to create a fake email for the user.

                window.alert("No email provided by social login. Please use another form of login");
                window.location.assign("/auth"); // redirect back to login page
            }
        } catch (err: any) {
            if (err.isSuperTokensGeneralError === true) {
                // this may be a custom error message sent from the API by you.
                window.alert(err.message);
            } else {
                window.alert("Oops! Something went wrong.");
            }
        }
    }
    ```

    </TabItem>
    <TabItem value="script">

    ```tsx
    import supertokens^{recipeNameCapitalLetters} from "supertokens-web-js-script/recipe/^{codeImportRecipeName}";
    async function handleGoogleCallback() {
        try {
            const response = await supertokens^{recipeNameCapitalLetters}.^{webjsThirdPartySignInUp}();

            if (response.status === "OK") {
                console.log(response.user)
                if (response.createdNewUser) {
                    // sign up successful
                } else {
                    // sign in successful
                }
                window.location.assign("/home");
            } else {
                // SuperTokens requires that the third party provider
                // gives an email for the user. If that's not the case, sign up / in
                // will fail.

                // As a hack to solve this, you can override the backend functions to create a fake email for the user.

                window.alert("No email provided by social login. Please use another form of login");
                window.location.assign("/auth"); // redirect back to login page
            }
        } catch (err: any) {
            if (err.isSuperTokensGeneralError === true) {
                // this may be a custom error message sent from the API by you.
                window.alert(err.message);
            } else {
                window.alert("Oops! Something went wrong.");
            }
        }
    }
    ```

    </TabItem>
    </NpmOrScriptTabs>    

:::important
On success, the backend will send back session tokens as part of the response headers which will be automatically handled by our frontend SDK for you.
:::

### Special case for login with Apple

## Flow 1b example
:::caution
Not supported by SuperTokens yet.
:::

</TabItem>

<TabItem value="mobile">

## Flow 1a example

### Step 1) Fetching the authorisation token on the frontend
TODO

### Step 2) Calling the signinup API to consume the authorisation token
TODO

## Flow 1b example
:::caution
Not supported by SuperTokens yet.
:::

----------------

## Flow 2 example

### Step 1) Fetching the OAuth / access tokens on the frontend
TODO

### Step 2) Calling the signinup API to use the OAuth tokens
TODO


</TabItem>

</FrontendCustomUITabs>

## See also

- [Post sign in / sign up action](TODO)
- [Changing OAuth provider's scope](TODO)
- [Integrating with a custom OAuth provider](TODO)
- [Getting the provider's access token on the backend](TODO)
- [Customising user ID format](TODO)