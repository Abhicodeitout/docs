---
id: change-password
title: Change a User's Password
hide_title: true
---

<!-- COPY DOCS -->
<!-- ./thirdpartyemailpassword/common-customizations/change-password.mdx -->

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';

# Change a User's Password

In this section we will go over how you can create a route on your backend which can update a user's password.

Calling this API will check if the old password is a valid credential and update the user's profile with the new password.

## Step 1: Creating the `/change-password` route
- You will first need to create a route on your backend which is protected with the `verifySession` Middleware
- The `verifySession` middleware will ensure that only an authenticated user can access the protected route.
- In this example `/change-password` will be the route on your backend which will be used to update a users password.

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

// highlight-start
app.post("/change-password", verifySession(), async (req, res) => {

})

// highlight-end
```
</TabItem>

<TabItem value="go">

```go
// highlight-start
// the following example uses net/http
func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {
    
}
// highlight-end
```

</TabItem>


<TabItem value="python">

```python
from supertokens_python.recipe.session.framework.flask import verify_session

# highlight-start
@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():
# highlight-end
```

</TabItem>

</BackendSDKTabs>


## Step 2: Use the `session` Object to retrive the user's info and check if the old password is a valid credential

- You can now use the `getUserId` function exposed by the `session` object to retrive the logged in user's `userId`.
- The user's profile can be retrived using the `getUserById` function.
- You can now call the `signIn` function and check if the old password is a valid credential

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.post("/change-password", verifySession(), async (req, res) => {

    // highlight-start
    // get the supertokens session object from the req
    let session = req.session

    // retrive the old password from the request body
    let oldPassword = req.body.oldPassword

    // get the user's Id from the session
    let userId = session.getUserId()

    // get the signed in user's email from the getUserById function
    let userInfo = await ^{recipeNameCapitalLetters}.getUserById(userId)

    // call signin to check that input password is correct

    let isPasswordValid = await ^{recipeNameCapitalLetters}.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }
    // highlight-end

})

```
</TabItem>

<TabItem value="go">

```go

func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

type ResponseBody struct {
    OldPassword string
    NewPassword string
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {
    // highlight-start
    // retrieve the session object as shown below
    sessionContainer := session.GetSessionFromRequestContext(r.Context())

    // retrive the old password from the request body
    var response ResponseBody
    err := json.NewDecoder(r.Body).Decode(&response)
    if err != nil {
        http.Error(w, err.Error(), http.StatusBadRequest)
        return
    }

    // get the userId from the session
    userID := sessionContainer.GetUserID()

    // get the signed in user's email from the getUserById function
    userInfo, err := ^{rid}d.GetUserById(userId)
    if err != nil {
        // TODO: Handle error
        return
    }


    // call signin to check that the input is correct
    isPasswordValid, err := ^{rid}.SignIn(userInfo.Email, response.OldPassword)
    if err != nil {
        // TODO: Handle error
        return
    }

    if isPasswordValid.OK == nil {
        // TODO: Invalid oldPassword
        return
    }
    // highlight-end
}

```
</TabItem>

<TabItem value="python">

```python
from supertokens_python.recipe.session.framework.flask import verify_session
from supertokens_python.recipe.^{rid}.syncio import get_user_by_id, sign_in

@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():

    # highlight-start
    session_ = g.supertokens
    
    # get the userId from the session object
    user_id = session_.get_user_id()

    # get the signed in user's email from the getUserById function
    users_info = get_user_by_id(user_id)
    
    # call signin to check that the input password is correct
    isPasswordValid = sign_in(users_info.email, request.json["oldPassword"])

    if isPasswordValid.status != "OK":
        return isPasswordValid.status
    # highlight-end

```
</TabItem>
</BackendSDKTabs>

## Step 3: Update the user's password

- You can now call the `updateEmailOrPassword` function to update the user's password.

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let Session = require("supertokens-node/recipe/session");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.get("/change-password", verifySession(), async (req, res) => {

    // get the session information from the req
    let session = req.session

    let oldPassword = req.body.oldPassword
    let updatedPassword = req.query.newPassword

    // get the users Id from the req.session
    let userId = session.getUserId()

    // get the signed in user's email from the getUserById function
    let userInfo = await ^{recipeNameCapitalLetters}.getUserById(userId)

    // call signin to check that input password is correct

    let isPasswordValid = await ^{recipeNameCapitalLetters}.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }

    // highlight-start
    // update the user's password using updateEmailOrPassword
    let response = await ^{recipeNameCapitalLetters}.updateEmailOrPassword({
        userId,
        password: updatedPassword
    })
    
    res.send({
        response
    })
    // highlight-end

})

```
</TabItem>

<TabItem value="go">

```go

func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

type ResponseBody struct {
    OldPassword string
    NewPassword string
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {

    // retrieve the session object as shown below
    sessionContainer := session.GetSessionFromRequestContext(r.Context())

    // retrive the old password from the request body
    var response ResponseBody
    err := json.NewDecoder(r.Body).Decode(&response)
    if err != nil {
        http.Error(w, err.Error(), http.StatusBadRequest)
        return
    }

    // get the userId from the session
    userID := sessionContainer.GetUserID()

    // get the signed in user's email from the getUserById function
    userInfo, err := ^{rid}d.GetUserById(userId)
    if err != nil {
        // TODO: Handle error
        return
    }


    // call signin to check that the input is correct
    isPasswordValid, err := ^{rid}.SignIn(userInfo.Email, response.OldPassword)
    if err != nil {
        // TODO: Handle error
        return
    }

    if isPasswordValid.OK == nil {
        // TODO: Invalid oldPassword
        return
    }

    // highlight-start
    _, err := ^{rid}.UpdateEmailOrPassword(userID, userInfo.email, response.NewPassword)

    if err != nil {
        // TODO: Handle error
    }
    // highlight-end
}

```
</TabItem>

<TabItem value="python">

```python
from supertokens_python.recipe.session.framework.flask import verify_session
from supertokens_python.recipe.^{rid}.syncio import get_user_by_id, sign_in, update_email_or_password

@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():
    session_ = g.supertokens
    
    # get the userId from the session object
    user_id = session_.get_user_id()

    # get the signed in user's email from the getUserById function
    users_info = get_user_by_id(user_id)
    
    # call signin to check that the input password is correct
    isPasswordValid = sign_in(users_info.email, request.json["oldPassword"])

    if isPasswordValid.status != "OK":
        return isPasswordValid.status
    
    # highlight-start
    # update the users password
    response = update_email_or_password(user_id, password=request.json["newPassword"])
    # highlight-start

    return response.status

```
</TabItem>

</BackendSDKTabs>

## Step 4: Revoke all sessions associated with the user (optional)

- You can now revoke all sessions created by the user by calling the `revokeAllSessionsForUser` function.

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let Session = require("supertokens-node/recipe/session");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.get("/change-password", verifySession(), async (req, res) => {

    // get the session information from the req
    let session = req.session

    let oldPassword = req.body.oldPassword
    let updatedPassword = req.query.newPassword

    // get the users Id from the req.session
    let userId = session.getUserId()

    // get the signed in user's email from the getUserById function
    let userInfo = await ^{recipeNameCapitalLetters}.getUserById(userId)

    // call signin to check that input password is correct

    let isPasswordValid = await ^{recipeNameCapitalLetters}.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }

    // update the user's password using updateEmailOrPassword
    let response = await ^{recipeNameCapitalLetters}.updateEmailOrPassword({
        userId,
        password: updatedPassword
    })

    // highlight-start
    // revoke all sessions for the user
    await Session.revokeAllSessionsForUser(userId)
    //highlight-end

    res.send({
        response
    })

})

```
</TabItem>

<TabItem value="go">

```go

func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

type ResponseBody struct {
    OldPassword string
    NewPassword string
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {

    // retrieve the session object as shown below
    sessionContainer := session.GetSessionFromRequestContext(r.Context())

    // retrive the old password from the request body
    var response ResponseBody
    err := json.NewDecoder(r.Body).Decode(&response)
    if err != nil {
        http.Error(w, err.Error(), http.StatusBadRequest)
        return
    }

    // get the userId from the session
    userID := sessionContainer.GetUserID()

    // get the signed in user's email from the getUserById function
    userInfo, err := ^{rid}d.GetUserById(userId)
    if err != nil {
        // TODO: Handle error
        return
    }


    // call signin to check that the input is correct
    isPasswordValid, err := ^{rid}.SignIn(userInfo.Email, response.OldPassword)
    if err != nil {
        // TODO: Handle error
        return
    }

    if isPasswordValid.OK == nil {
        // TODO: Invalid oldPassword
        return
    }

    _, err := ^{rid}.UpdateEmailOrPassword(userID, userInfo.email, response.NewPassword)

    if err != nil {
        // TODO: Handle error
    }

    // highlight-start
    _, err := session.RevokeAllSessionsForUser(userID)
    if err != nil {
        // TODO: Handle error
    }
    // highlight-end
}

```
</TabItem>

<TabItem value="python">

```python
from supertokens_python.recipe.session.framework.flask import verify_session
from supertokens_python.recipe.^{rid}.syncio import get_user_by_id, sign_in, update_email_or_password
from supertokens_python.recipe.session.syncio import revoke_all_sessions_for_user

@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():
    session_ = g.supertokens
    
    # get the userId from the session object
    user_id = session_.get_user_id()

    # get the signed in user's email from the getUserById function
    users_info = get_user_by_id(user_id)
    
    # call signin to check that the input password is correct
    isPasswordValid = sign_in(users_info.email, request.json["oldPassword"])

    if isPasswordValid.status != "OK":
        return isPasswordValid.status
    
    # update the users password
    response = update_email_or_password(user_id, password=request.json["newPassword"])

    # highlight-start
    # revoke all sessions for the user
    revoke_all_sessions_for_user(user_id)
    # highlight-end

    return response.status

```
</TabItem>

</BackendSDKTabs>
