---
id: change-password
title: Allow users to change their passwords
hide_title: true
---

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import BackendSDKCasing from "/src/components/BackendSDKCasing"
import IntroductionSnippet from "/thirdpartyemailpassword/common-customizations/_change-password-introduction-snippet.mdx"
import EndingSnippet from "/thirdpartyemailpassword/common-customizations/_change-password-ending-snippet.mdx"
import TabItem from '@theme/TabItem';

# Allow users to change their passwords

:::caution
SuperTokens does not provide the UI for users to change/update their password, you will need to create the UI and setup a route on your backend to have this functionality.
:::

In this section we will go over how you can create a route on your backend which can update a user's password. Calling this route will check if the old password is valid and update the user's profile with the new password.

## Step 1: Creating the `/change-password` route
- You will need to create a route on your backend which is protected by the session verification middleware, this will ensure that only a authenticated user can access the protected route.
- To learn more about how to use the session verfication middleware for other frameworks click [here](verify-session)

<IntroductionSnippet/>

## Step 2: Validate and update the user's password

- You can now use `session` object to retrive the logged in user's `userId`.
- Use the recipe's `signIn`function and check if the old password is valid
- You can update the user's password with the `updateEmailOrPassword` function. 

<BackendSDKTabs>
<TabItem value="nodejs">

```jsx
// the following example uses express
let ^{recipeNameCapitalLetters} = require("supertokens-node/recipe/^{codeImportRecipeName}");
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

app.post("/change-password", verifySession(), async (req, res) => {

    // highlight-start
    // get the supertokens session object from the req
    let session = req.session

    // retrive the old password from the request body
    let oldPassword = req.body.oldPassword

    // get the user's Id from the session
    let userId = session.getUserId()

    // get the signed in user's email from the getUserById function
    let userInfo = await ^{recipeNameCapitalLetters}.getUserById(userId)

    // call signin to check that input password is correct
    let isPasswordValid = await ^{recipeNameCapitalLetters}.signIn(userInfo.email, oldPassword)

    if (isPasswordValid.status !== "OK") {
        res.send({
            status: isPasswordValid.status
        })

        return
    }

    // update the user's password using updateEmailOrPassword

    let response = await ^{recipeNameCapitalLetters}.updateEmailOrPassword({
        userId,
        password: updatedPassword
    })
    
    res.send({
        status: response.status
    })
    // highlight-end

})

```
</TabItem>

<TabItem value="go">

```go

func main() {
    // Wrap the API handler in session.VerifySession
    session.VerifySession(nil, changePasswordAPI).ServeHTTP(rw, r)
}

type ResponseBody struct {
    OldPassword string
    NewPassword string
}

func changePasswordAPI(w http.ResponseWriter, r *http.Request) {

	// retrieve the session object as shown below
	sessionContainer := session.GetSessionFromRequestContext(r.Context())

	// retrive the old password from the request body
	var response ResponseBody
	err := json.NewDecoder(r.Body).Decode(&response)
	if err != nil {
		http.Error(w, err.Error(), http.StatusBadRequest)
		return
	}

	// get the userId from the session
	userID := sessionContainer.GetUserID()

	// get the signed in user's email from the getUserById function
	userInfo, err := ^{rid}.GetUserById(userID)
	if err != nil {
		// TODO: Handle error
		return
	}

	// call signin to check that the input is correct
	isPasswordValid, err := ^{rid}.SignIn(userInfo.Email, response.OldPassword)
	if err != nil {
		// TODO: Handle error
		return
	}

    // highlight-start
	if isPasswordValid.OK == nil {
		// TODO: Handle error
		return
	}

    response, err = ^{rid}.UpdateEmailOrPassword(userID, &userInfo.Email, &response.NewPassword)
	if err != nil {
		// TODO: Handle error
		return
	}
    // highlight-end

    resp := make(map[string]string)
    if response.OK != nil { 
        resp["status"] = "OK"
    } else {
        resp["status"] = "Could not update"
    }
	jsonResp, err := json.Marshal(resp)
	if err != nil {
		log.Fatalf("Error happened in JSON marshal. Err: %s", err)
	}
	w.Write(jsonResp)
}

```
</TabItem>

<TabItem value="python">

```python
from supertokens_python.recipe.session.framework.flask import verify_session
from supertokens_python.recipe.^{rid}.syncio import get_user_by_id, sign_in

@app.route('/change-password', methods=['POST'])
@verify_session()
def change_password():

    # highlight-start
    session_ = g.supertokens
    
    # get the userId from the session object
    user_id = session_.get_user_id()

    # get the signed in user's email from the getUserById function
    users_info = get_user_by_id(user_id)
    
    # call signin to check that the input password is correct
    isPasswordValid = sign_in(users_info.email, request.json["oldPassword"])

    if isPasswordValid.status != "OK":
        return isPasswordValid.status
    
    # update the users password
    response = update_email_or_password(user_id, password=request.json["newPassword"])
    return response.status
    # highlight-end

```
</TabItem>
</BackendSDKTabs>

## Step 3: Revoke all sessions associated with the user (optional)

- You can now invalidate all sessions associated with the user so they can login with their new password.

<EndingSnippet/>
