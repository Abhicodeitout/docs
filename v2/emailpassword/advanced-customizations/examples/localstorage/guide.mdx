---
id: guide
title: Guide
hide_title: true
---
import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs"
import FrontendSDKTabs from "/src/components/tabs/FrontendSDKTabs"
import TabItem from '@theme/TabItem';

<!-- COPY DOCS -->
<!-- ./session/advanced-customizations/examples/localstorage/guide.mdx -->

# Step-by-step guide

In this guide we'll modify an [example application](https://github.com/supertokens/supertokens-demo-react/tree/emailpassword/) to use localstorage instead of cookies.
You can find the modified application [here](https://github.com/supertokens/supertokens-auth-react/blob/master/examples/with-localstorage/)

## Backend

On the backend we need to modify the `api-server.js` to allow and make use of our custom cookie.
You can find the result [here](https://github.com/supertokens/supertokens-auth-react/blob/localstorage-example/examples/with-localstorage/api-server.js).

### 1. Allow the custom header on requests
First, we need to allow the frontend to send the `st-cookie` header we chose to transfer the tokens.
We can do this by adding it to `allowedHeaders` in the cors config, as seen [here])(https://github.com/supertokens/supertokens-auth-react/blob/localstorage-example/examples/with-localstorage/api-server.js#L125).

### 2. Adding a helper
Then, we need to add a helper function that will handle copying the `Set-Cookie` header into our custom header and also add that header
to the `access-control-expose-headers` list so that the frontend can access it on CORS requests.
You can find the implementation [here](https://github.com/supertokens/supertokens-auth-react/blob/localstorage-example/examples/with-localstorage/api-server.js#L14-L30).

### 3. Send the tokens using a custom header

Finally, we need to override most of the functions and APIs of the `Session` recipe to have them use the header enabled in the first step and to 
use the helper function defined in the second step to send tokens to the frontend.
You can find the modified session recipe [here](https://github.com/supertokens/supertokens-auth-react/blob/localstorage-example/examples/with-localstorage/api-server.js#L43-L116)

## Frontend
On the frontend we need to modify our SuperTokens configuration and patch the global fetch function to add our custom header. 
You can find the modified `App.js` [here](https://github.com/supertokens/supertokens-auth-react/blob/localstorage-example/examples/with-localstorage/src/App.js).

### 1. Adding a helper to store cookies
First, we need to add a helper function that will process the custom header and store the cookies in the proper format.
A simple implementation can be found [here](https://github.com/supertokens/supertokens-auth-react/blob/localstorage-example/examples/with-localstorage/src/App.js#L126-L155).
Please keep in mind, that this isn't an equivalent replacement for cookies, there are a lot of features we didn't implement in the example. These could be done,
but our recommendation is to use cookies if at all possible.

### 2. Replace global fetch
Then, we need to replace the global fetch to make use of the custom header.
We need to do this because fetch is used internally by the SuperTokens SDK, and we have no other way of getting access to response headers.

:::important
- This has to be done before calling `SuperTokens.init`
:::

<FrontendSDKTabs>
<TabItem value="reactjs">

```jsx
const origFetch = window.fetch;
window.fetch = async (input, init) => {
    // Check if the we need to add the cookies
    if (isApiDomain(input.url || input)) {
        if (init === undefined) {
            init = {};
        }
        if (init.headers === undefined) {
            init.headers = {};
        }

        // Simply add the stored string into a header, it's already in the correct format.
        const stCookies = localStorage.getItem("st-cookie");
        if (stCookies) {
            init.headers["st-cookie"] = stCookies;
        }
    }

    const res = await origFetch(input, init);

    // Check if the we need to process the cookies in the response
    if (isApiDomain(input.url || input)) {
        const respCookies = res.headers.get("st-cookie");

        setCookiesInLocalstorage(respCookies);
    }
    return res;
};

```
</TabItem>
<TabItem value="vanillajs">

```jsx
const origFetch = window.fetch;
window.fetch = async (input, init) => {
    // Check if the we need to add the cookies
    if (isApiDomain(input.url || input)) {
        if (init === undefined) {
            init = {};
        }
        if (init.headers === undefined) {
            init.headers = {};
        }

        // Simply add the stored string into a header, it's already in the correct format.
        const stCookies = localStorage.getItem("st-cookie");
        if (stCookies) {
            init.headers["st-cookie"] = stCookies;
        }
    }

    const res = await origFetch(input, init);

    // Check if the we need to process the cookies in the response
    if (isApiDomain(input.url || input)) {
        const respCookies = res.headers.get("st-cookie");

        setCookiesInLocalstorage(respCookies);
    }
    return res;
};

```
</TabItem>
</FrontendSDKTabs>

### 3. Clearing cookies on logout

Finally, we need to add an event handler that will clear the cookies on logout

<FrontendSDKTabs>
<TabItem value="reactjs">

```jsx
SuperTokens.init({
    appInfo: {...},
    recipeList: [
        ...,
        Session.init({
            //highlight-start
            onHandleEvent: (recipeEvent) => {
                // Clear all cookies if the session expired and on signout
                if (["SIGN_OUT", "UNAUTHORISED"].includes(recipeEvent.action)) {
                    localStorage.removeItem("st-cookie");
                }
            },
            //highlight-end
        }),
    ],
});
```
</TabItem>
<TabItem value="vanillajs">

```jsx
SuperTokens.init({
    appInfo: {...},
    recipeList: [
        ...,
        Session.init({
            //highlight-start
            onHandleEvent: (recipeEvent) => {
                // Clear all cookies if the session expired and on signout
                if (["SIGN_OUT", "UNAUTHORISED"].includes(recipeEvent.action)) {
                    localStorage.removeItem("st-cookie");
                }
            },
            //highlight-end
        }),
    ],
});
```
</TabItem>
</FrontendSDKTabs>

4. An optional step is to add an `axios` interceptor

:::important
- This step is only applicable if you are using `axios`
:::

<FrontendSDKTabs>
<TabItem value="reactjs">

```jsx
axios.interceptors.request.use(
    function (config) {
        // Check if the we need to add the cookies
        if (isApiDomain(config.url)) {
            const stCookies = localStorage.getItem("st-cookie");
            if (stCookies) {
                // Simply add the stored string into a header, it's already in the correct format.
                config.headers["st-cookie"] = stCookies;
            }
        }
        return config;
    },
    function (error) {
        return Promise.reject(error);
    }
);

axios.interceptors.response.use(
    function (res) {
        // Check if the we need to process the cookies in the response
        if (isApiDomain(res.config.url)) {
            const respCookies = res.headers["st-cookie"];

            setCookiesInLocalstorage(respCookies);
        }
        return res;
    },
    // We need to process error responses as well
    function (error) {
        // Check if the we need to process the cookies in the response
        if (isApiDomain(error.config.url)) {
            const res = error.response;
            const respCookies = res.headers["st-cookie"];

            setCookiesInLocalstorage(respCookies);
        }
        return Promise.reject(error);
    }
);
```
</TabItem>
<TabItem value="vanillajs">

```jsx
axios.interceptors.request.use(
    function (config) {
        // Check if the we need to add the cookies
        if (isApiDomain(config.url)) {
            const stCookies = localStorage.getItem("st-cookie");
            if (stCookies) {
                // Simply add the stored string into a header, it's already in the correct format.
                config.headers["st-cookie"] = stCookies;
            }
        }
        return config;
    },
    function (error) {
        return Promise.reject(error);
    }
);

axios.interceptors.response.use(
    function (res) {
        // Check if the we need to process the cookies in the response
        if (isApiDomain(res.config.url)) {
            const respCookies = res.headers["st-cookie"];

            setCookiesInLocalstorage(respCookies);
        }
        return res;
    },
    // We need to process error responses as well
    function (error) {
        // Check if the we need to process the cookies in the response
        if (isApiDomain(error.config.url)) {
            const res = error.response;
            const respCookies = res.headers["st-cookie"];

            setCookiesInLocalstorage(respCookies);
        }
        return Promise.reject(error);
    }
);
```
</TabItem>
</FrontendSDKTabs>

<!-- COPY DOCS -->