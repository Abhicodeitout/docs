---
id: backend-config
title: 2. Backend config
hide_title: true
---

<!-- COPY SECTION -->
<!-- ./emailpassword/serverless/with-aws-lambda/backend-config.mdx -->
<!-- 1 -->

import AppInfoForm from "/src/components/appInfoForm"
import CoreInjector from "/src/components/coreInjector"
import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';

# 2. Backend config

## 1) Create Lambda layer for required libraries

<BackendSDKTabs>
<TabItem value="nodejs">

```bash
mkdir lambda && cd lambda
touch lambdaFunction.js

# Run these commands
npm i -s supertokens-node @middy/core @middy/http-cors
cp -r node_modules nodejs # TODO: Verify this
zip -r supertokens-layer.zip nodejs/
```

</TabItem>
<TabItem value="python">

```bash
# Run these commands:  
mkdir lambda && cd lambda
touch lambda_function.py requirements.txt

# TODO: Add lambda_function.py content for boilerplate:

# Create requirements.txt file with the following content:
fastapi
uvicorn
mangum
nest_asyncio
supertokens-python

# Run these commands:
pip install --target ./python -r requirements.txt
cd python && rm -r *dist-info **/__pycache__ && cd ..
zip -r supertokens-layer.zip python/
```

</TabItem>
</BackendSDKTabs>

## 2) Upload supertokens lambda layer
<!-- TODO: Fix images: -->
- Open AWS Lambda dashboard and click on layers:
<img src="https://user-images.githubusercontent.com/20884782/190074706-3d1b6420-e812-48d9-aa04-8ea2d4a4c62d.png" height="300" />

- Click "Create Layer" button:
<img src="https://user-images.githubusercontent.com/20884782/190075143-57768a61-7efc-4b3d-a865-0d68e84f3005.png" width="600" />

<!-- TODO: Add selector for python/node? -->

- Give a name for your layer, upload the zip and select the nodejs 16 runtime
<img src="https://user-images.githubusercontent.com/20884782/190076214-47e1ba13-3f17-4dcb-afc9-90b3e8c0f53c.png" height="600" />

<!-- END COPY SECTION -->

## 3) Create a backend config function


import { PasswordlessBackendForm } from "/src/components/snippetConfigForm/passwordlessBackendForm";

<AppInfoForm
    askForAppName
    askForAPIDomain
    askForWebsiteDomain
>

<PasswordlessBackendForm>

<CoreInjector>

<!-- TODO: Remove Session.init() and session.init() if rid=session -->
<BackendSDKTabs>
<TabItem value="nodejs">

```tsx

import Passwordless from 'supertokens-node/recipe/passwordless';
import Session from 'supertokens-node/recipe/session'

function getBackendConfig() {
  return {
    framework: "awsLambda",
    supertokens: {
      ^{coreInjector_connection_uri_comment}
      connectionURI: ^{coreInjector_uri}
      ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
      // learn more about this on https://supertokens.com/docs/passwordless/appinfo
      appName: "^{form_appName}",
      apiDomain: "^{form_apiDomain}",
      websiteDomain: "^{form_websiteDomain}",
      apiBasePath: "^{form_apiBasePath}",
      websiteBasePath: "^{form_websiteBasePath}",
      apiGatewayPath: "/dev" // TODO: same as what's set on the frontend config
    },
    recipeList: [
      Passwordless.init(
        flowType: "^{form_flowType}",
        contactMethod: "^{form_contactMethod}"
      ),
      Session.init(),
    ],
    isInServerlessEnv: true,
  }
}

module.exports.getBackendConfig = getBackendConfig;
```
</TabItem>

<TabItem value="python">

```python
import nest_asyncio
nest_asyncio.apply()

from fastapi import FastAPI, Depends
from starlette.middleware.cors import CORSMiddleware
from mangum import Mangum

from supertokens_python import init, SupertokensConfig, InputAppInfo, get_all_cors_headers
from supertokens_python.framework.fastapi import get_middleware
from supertokens_python.recipe.session import SessionContainer
from supertokens_python.recipe.session.framework.fastapi import verify_session
from supertokens_python.recipe import session, passwordless
^{form_contactMethod_import_Python}

init(
    supertokens_config=SupertokensConfig(
        ^{coreInjector_connection_uri_comment_with_hash}
        connection_uri=^{coreInjector_uri}
        ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
    ),
    app_info=InputAppInfo(
        # learn more about this on https://supertokens.com/docs/passwordless/appinfo
        app_name="^{form_appName}",
        api_domain="^{form_apiDomain}",
        website_domain="^{form_websiteDomain}",
        api_base_path="^{form_apiBasePath}",
        website_base_path="^{form_websiteBasePath}",
        api_gateway_path="/dev",
    ),
    framework="fastapi",
    recipe_list=[
        session.init(),
        passwordless.init(
          flow_type="^{form_flowType}",
          contact_config=^{form_contactMethod_initialize_Python}()
        ),
    ],
    mode="asgi",
)


app = FastAPI(title="^{form_appName}")
app.add_middleware(get_middleware())

app = CORSMiddleware(
    app=app,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["GET", "PUT", "POST", "DELETE", "OPTIONS", "PATCH"],
    allow_headers=["Content-Type"] + get_all_cors_headers(),
)

handler = Mangum(app)
```

</TabItem>

</BackendSDKTabs>

</CoreInjector>


</PasswordlessBackendForm>

</AppInfoForm>


<!-- COPY SECTION -->
<!-- ./emailpassword/serverless/with-aws-lambda/backend-config.mdx -->
<!-- 2 -->

## 4) Link lambda layer with lambda function

<!-- TODO: Fix images: -->

- Scroll to the bottom and look for the `Layers` tab. Click on `Add a layer`
<img src="https://user-images.githubusercontent.com/20884782/190076987-02e9f585-d870-4dac-bd96-d55ce71596c4.png" width="700"/>

- Select `Custom Layer` and then select the layer we created in the first step:
<img src="https://user-images.githubusercontent.com/20884782/190077385-55f9db2f-190b-42ed-ab09-70d94ec3b7a3.jpg" height="500" />

- Add the layer that we created in the first step. You layers tab should look something like this:
<img src="https://user-images.githubusercontent.com/20884782/190077670-fa4d1db4-67c6-4827-b52f-3f978d36b2be.jpg" width="700" height="200" />

<!-- END COPY SECTION -->
