---
id: create-session
title: 4. Creating Sessions
hide_title: true
---

# Creating sessions

```tsx
import { ApolloServer } from "@apollo/server";
import express from "express";
import { expressMiddleware } from "@apollo/server/express4";
import Session from "supertokens-node/recipe/session";
import {errorHandler} from "supertokens-node/framework/express/index.js";

let app = express();

const typeDefs = `
type Mutation {
    login(email: String, password: String)
}
`
const resolvers = {
    // highlight-start
    Mutation: {
        login: async (_: any, args: any, contextValue: any) => {
            let {email, password} = args;
                
            // TODO: Validate credentials
            let userId = "userId";
            await Session.createNewSession(contextValue.req, contextValue.res, userId);
            return "Session Created";
        },
    },
    // highlight-end
}

const server = new ApolloServer({
    typeDefs,
    resolvers,
    plugins: [
        {
            requestDidStart: async () => {
                return {
                    didEncounterErrors: async (requestContext) => {
                        const {req, res} = requestContext.contextValue as any;
                        for (let i = 0; i < requestContext.errors.length; i++) {
                            let error = requestContext.errors[i].originalError;
                            await new Promise(async (resolve) => {
                                // This will handle any session or other SuperTokens related errors
                                await errorHandler()(error, req, res, (err) => {
                                    resolve(undefined);
                                });
                            });
                        }
                    },
                };
            }
        }
    ],
})

server.start().then(() => {
    // Use expressMiddleware only after server.start has resolved
    app.use(express.json(), expressMiddleware(server, {
        context: async ({req, res}) => {
            return {
                req,
                res,
            };
        },
    }))

    app.listen(3001, () => {
        console.log("Server started");
    })
})
```