---
id: revoke-session
title: 5. Revoking Sessions
hide_title: true
---

# Revoking Sessions

```tsx
import { ApolloServer } from "@apollo/server";
import express from "express";
import { expressMiddleware } from "@apollo/server/express4";
import Session from "supertokens-node/recipe/session";

const typeDefs = `
type Mutation {
    logout()
}
`
const resolvers = {
    // highlight-start
    Mutation: {
        logout: async (_: any, args: any, contextValue: any) => {
            let session = await Session.createNewSession(contextValue.req, contextValue.res, userId);
            await session.revokeSession();
            return "Session revoked";
        },
    },
    // highlight-end
}

const server = new ApolloServer({
    typeDefs,
    resolvers,
    plugins: [
        {
            requestDidStart: async () => {
                return {
                    didEncounterErrors: async (requestContext) => {
                        const {req, res} = requestContext.contextValue as any;
                        for (let i = 0; i < requestContext.errors.length; i++) {
                            let error = requestContext.errors[i].originalError;
                            await new Promise(async (resolve) => {
                                // This will handle any session or other SuperTokens related errors
                                await errorHandler()(error, req, res, (err) => {
                                    resolve(undefined);
                                });
                            });
                        }
                    },
                };
            }
        }
    ],
})

server.start().then(() => {
    // Use expressMiddleware only after server.start has resolved
    app.use(express.json(), verifySession({sessionRequired: false}), expressMiddleware(server, {
        context: async ({req, res}) => {
            return {
              // req.session will be undefined if a session does not exist
                session: (req as any).session,
                req,
                res,
            };
        },
    }))

    app.listen(3001, () => {
        console.log("Server started");
    })
})
```