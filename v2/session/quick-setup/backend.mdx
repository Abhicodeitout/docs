---
id: backend
title: Step 2) Backend
hide_title: true
---

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';
import NodeJSFrameworkSubTabsServerless from "/src/components/tabs/NodeJSFrameworkSubTabsServerless"
import GoFrameworkSubTabs from "/src/components/tabs/GoFrameworkSubTabs"
import AppInfoForm from "/src/components/appInfoForm"
import CoreInjector from "/src/components/coreInjector"

# Backend Integration 

## 1) Install

<BackendSDKTabs>
<TabItem value="nodejs">

```bash
npm i -s supertokens-node
```
</TabItem>
<TabItem value="go">

```bash
go get github.com/supertokens/supertokens-golang
```

</TabItem>
</BackendSDKTabs>

## 2) Initialise SuperTokens

<AppInfoForm
    askForAppName={true}
    askForAPIDomain={true}
    askForWebsiteDomain={true}>

<CoreInjector>

Add the code below to your server's init file.

<BackendSDKTabs>
<TabItem value="nodejs">

<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");

supertokens.init({
    framework: "express",
    supertokens: {
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}"
    },
    recipeList: [
        Session.init()
    ]
});
```
</TabItem>

<TabItem value="hapi">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");

supertokens.init({
    framework: "hapi",
    supertokens: {
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}"
    },
    recipeList: [
        Session.init()
    ]
});
```
</TabItem>

<TabItem value="fastify">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");

supertokens.init({
    framework: "fastify",
    supertokens: {
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}"
    },
    recipeList: [
        Session.init()
    ]
});
```
</TabItem>

<TabItem value="koa">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");

supertokens.init({
    framework: "koa",
    supertokens: {
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}"
    },
    recipeList: [
        Session.init()
    ]
});
```
</TabItem>

<TabItem value="loopback">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");

supertokens.init({
    framework: "loopback",
    supertokens: {
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}"
    },
    recipeList: [
        Session.init()
    ]
});
```
</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	err := supertokens.Init(supertokens.TypeInput{
		Supertokens: &supertokens.ConnectionInfo{
            ConnectionURI: ^{coreInjector_uri}
            ^{coreInjector_api_key_commented}APIKey: ^{coreInjector_api_key},
		},
		AppInfo: supertokens.AppInfo{
			AppName: "^{form_appName}",
			APIDomain: "^{form_apiDomain}",
			WebsiteDomain: "^{form_websiteDomain}",
		},
		RecipeList: []supertokens.Recipe{
			session.Init(nil),
		},
	})

	if err != nil {
		panic(err.Error())
	}
}
```
</TabItem>
</BackendSDKTabs>

</CoreInjector>

</AppInfoForm>

## 3) Add the SuperTokens APIs & CORS setup

<AppInfoForm
    askForWebsiteDomain={true}>

<BackendSDKTabs>
<TabItem value="nodejs">
<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

Add the `middleware` **BEFORE all your routes**.

```jsx
let cors = require("cors");
let supertokens = require("supertokens-node");
let {middleware} = require("supertokens-node/framework/express");

let app = express();

// ...other middlewares
app.use(cors({
	// highlight-start
    origin: "^{form_websiteDomain}",
    allowedHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
    credentials: true,
    // highlight-end
}));

// highlight-next-line
app.use(middleware());

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/session/refresh`: It is used to get a new refresh and access token in case the older one expires.
- `POST /auth/signout`: It is used sign out the currently logged in user.

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="hapi">

Register the `plugin`.

```jsx
let supertokens = require("supertokens-node");
let { plugin } = require("supertokens-node/framework/hapi");

let server = Hapi.server({ port: 8000 });

// ...other middlewares
server.route({
    config: {
        // highlight-start
        cors: {
            origin: "^{form_websiteDomain}",
            additionalHeaders: [...supertokens.getAllCORSHeaders()],
            credentials: true,
        }
        // highlight-end
    }
});

(async() => {
    // highlight-next-line
    await server.register(plugin);
    
    await server.start();
})();

// ...your API routes
```
This `plugin` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)) as well take care of all the errors thrown by the Supertokens library:
- `POST /auth/session/refresh`: It is used to get a new refresh and access token in case the older one expires.
- `POST /auth/signout`: It is used sign out the currently logged in user.

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="fastify">

Register the `plugin`.

```jsx
let cors = require("fastify-cors");
let supertokens = require("supertokens-node");
let { plugin } = require("supertokens-node/framework/fastify");

let fastify = require('fastify')();

// ...other middlewares
// highlight-start
fastify.register(cors, { 
    origin: "^{form_websiteDomain}",
    allowedHeaders: ['Content-Type', ...supertokens.getAllCORSHeaders()],
    credentials: true,
})
// highlight-end

(async() => {
    // highlight-next-line
    await server.register(plugin);
    
    await server.start();
})();

// ...your API routes
```
This `plugin` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/session/refresh`: It is used to get a new refresh and access token in case the older one expires.
- `POST /auth/signout`: It is used sign out the currently logged in user.

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="koa">

Add the `middleware` **BEFORE all your routes**.

```jsx
let cors = require('@koa/cors');
let supertokens = require("supertokens-node");
let {middleware} = require("supertokens-node/framework/koa");

let app = new Koa();

// ...other middlewares
app.use(cors({
	// highlight-start
    origin: "^{form_websiteDomain}",
    allowHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
    credentials: true,
    // highlight-end
}));

// highlight-next-line
app.use(middleware());

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/session/refresh`: It is used to get a new refresh and access token in case the older one expires.
- `POST /auth/signout`: It is used sign out the currently logged in user.

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="loopback">

Add the `middleware` **BEFORE all your routes**.

```tsx
import supertokens from "supertokens-node";
import {middleware} from "supertokens-node/framework/loopback";

let app = new RestApplication({
    rest: {
        cors: {
			// highlight-start
            origin: "^{form_websiteDomain}",
            allowedHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
            credentials: true
            // highlight-end
        }
    }
});

// highlight-next-line
app.middleware(middleware);

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/session/refresh`: It is used to get a new refresh and access token in case the older one expires.
- `POST /auth/signout`: It is used sign out the currently logged in user.

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
</NodeJSFrameworkSubTabsServerless>


</TabItem>
<TabItem value="go">
<GoFrameworkSubTabs>
<TabItem value="http">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"
	"strings"

	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...

    //highlight-start
	http.ListenAndServe("SERVER ADDRESS", corsMiddleware(
		supertokens.Middleware(http.HandlerFunc(func(rw http.ResponseWriter,
    //highlight-end
        r *http.Request) {
			// TODO: Handle your APIs..

		}))))
}

func corsMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(response http.ResponseWriter, r *http.Request) {
		response.Header().Set("Access-Control-Allow-Origin", "^{form_websiteDomain}")
		response.Header().Set("Access-Control-Allow-Credentials", "true")
		if r.Method == "OPTIONS" {
			// we add content-type + other headers used by SuperTokens
			response.Header().Set("Access-Control-Allow-Headers",
				strings.Join(append([]string{"Content-Type"},
                //highlight-start
					supertokens.GetAllCORSHeaders()...), ","))
                //highlight-end
			response.Header().Set("Access-Control-Allow-Methods", "*")
			response.Write([]byte(""))
		} else {
			next.ServeHTTP(response, r)
		}
	})
}
```

</TabItem>
<TabItem value="gin">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"
	"time"

	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...

	router := gin.New()

	// CORS
	router.Use(cors.New(cors.Config{
		AllowOrigins: []string{"^{form_websiteDomain}"},
		AllowMethods: []string{"GET", "POST", "DELETE", "PUT", "OPTIONS"},
		AllowHeaders: append([]string{"content-type"},
        // highlight-next-line
			supertokens.GetAllCORSHeaders()...),
		AllowCredentials: true,
	}))

	// Adding the SuperTokens middleware
    // highlight-start
	router.Use(func(c *gin.Context) {
		supertokens.Middleware(http.HandlerFunc(
			func(rw http.ResponseWriter, r *http.Request) {
				c.Next()
			})).ServeHTTP(c.Writer, c.Request)
		// we call Abort so that the next handler in the chain is not called, unless we call Next explicitly
		c.Abort()
	})
    // highlight-end

	// Add APIs and start server
}
```

</TabItem>
<TabItem value="chi">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"github.com/go-chi/chi"
	"github.com/go-chi/cors"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...
    
	r := chi.NewRouter()

	// CORS
	r.Use(cors.Handler(cors.Options{
		AllowedOrigins: []string{"^{form_websiteDomain}"},
		AllowedMethods: []string{"GET", "POST", "PUT", "DELETE", "OPTIONS"},
		AllowedHeaders: append([]string{"Content-Type"},
			//highlight-next-line
			supertokens.GetAllCORSHeaders()...),
		AllowCredentials: true,
	}))

	// SuperTokens Middleware
	//highlight-next-line
	r.Use(supertokens.Middleware)

	// Add APIs and start server
}
```
</TabItem>
<TabItem value="mux">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"

	"github.com/gorilla/handlers"
	"github.com/gorilla/mux"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	// SuperTokens init...

	// Add APIs

	router := mux.NewRouter()

	// Adding handlers.CORS(options)(supertokens.Middleware(router)))
	//highlight-start
	http.ListenAndServe("SERVER ADDRESS", handlers.CORS(
		handlers.AllowedHeaders(append([]string{"Content-Type"},
			supertokens.GetAllCORSHeaders()...)),
		handlers.AllowedMethods([]string{"GET", "POST", "PUT", "HEAD", "OPTIONS"}),
		handlers.AllowedOrigins([]string{"^{form_websiteDomain}"}),
		handlers.AllowCredentials(),
	)(supertokens.Middleware(router)))
	//highlight-end
}
```
</TabItem>
</GoFrameworkSubTabs>

This `Middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/session/refresh`: It is used to get a new refresh and access token in case the older one expires.
- `POST /auth/signout`: It is used sign out the currently logged in user.

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 

</TabItem>
</BackendSDKTabs>

</AppInfoForm>

## 4) Add the SuperTokens error handler

<BackendSDKTabs>
<TabItem value="nodejs">

<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```jsx
let {errorHandler} = require("supertokens-node/framework/express");
// ...your API routes

// highlight-start
// Add this AFTER all your routes
app.use(errorHandler())
// highlight-end

// your own error handler
app.use((err, req, res, next) => {...});

```
</TabItem>
<TabItem value="hapi">

No additional `errorHandler` is required.

</TabItem>
<TabItem value="fastify">

Add the `errorHandler` **Before all your routes and plugin registration**

```jsx
let {errorHandler} = require("supertokens-node/framework/fastify");

// highlight-next-line
fastify.setErrorHandler(errorHandler());

// ...your API routes

```
</TabItem>
<TabItem value="koa">

No additional `errorHandler` is required.

</TabItem>
<TabItem value="loopback">

No additional `errorHandler` is required.

</TabItem>
</NodeJSFrameworkSubTabsServerless>

</TabItem>
<TabItem value="go">

:::info
You can skip this step
:::

</TabItem>
</BackendSDKTabs>

## 5) Add session verification to your API
For your APIs that require a user to be logged in, use the `verifySession` middleware:


<BackendSDKTabs>
<TabItem value="nodejs">

<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

//highlight-start
app.post("/like-comment", verifySession(), (req, res) => {
    let userId = req.session.getUserId();
    //highlight-end
    //....
});
```
</TabItem>
<TabItem value="hapi">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/hapi");

server.route({
    path: "/like-comment",
    method: "post",
    //highlight-start
    options: {
        pre: [
            {
                method: verifySession()
            },
        ],
    },
    handler: async (req, res) => {
        let userId = req.session.getUserId();
        //highlight-end
        //...
    }
})
```
</TabItem>
<TabItem value="fastify">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/fastify");

//highlight-start
fastify.post("/like-comment", {
    preHandler: verifySession(),
}, (req, res) => {
    let userId = req.session.getUserId();
    //highlight-end
    //....
});
```
</TabItem>
<TabItem value="koa">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/fastify");

//highlight-start
router.post("/like-comment", verifySession(), (ctx, next) => {
    let userId = ctx.session.getUserId();
    //highlight-end
    //....
});
```

</TabItem>
<TabItem value="loopback">

```tsx
import { verifySession } from "supertokens-node/recipe/session/framework/loopback";

class LikeComment {
    //highlight-start
    constructor(@inject(RestBindings.Http.CONTEXT) private ctx: MiddlewareContext) {}
    @post("/like-comment")
    @intercept(verifySession())
    @response(200)
    handler() {
        let userId = ((this.ctx as any).session as Session.SessionContainer).getUserId();
        //highlight-end
        //....
    }
}
```

</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">
<GoFrameworkSubTabs>
<TabItem value="http">

```go
import (
	"net/http"

	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	http.ListenAndServe("SERVER ADDRESS", corsMiddleware(
		supertokens.Middleware(http.HandlerFunc(func(rw http.ResponseWriter, r *http.Request) {
			// Handle your APIs..
			if r.URL.Path == "/sessioninfo" {
				// Calling the API with session verification
				//highlight-next-line
				session.VerifySession(nil, sessioninfo).ServeHTTP(rw, r)
				return
			}
		}))))
}

// This is the API handler.
func sessioninfo(w http.ResponseWriter, r *http.Request) {
    // Fetching the session object and reading the userID
    //highlight-start
	sessionContainer := session.GetSessionFromRequestContext(r.Context())
	userId := sessionContainer.GetUserID()
    //highlight-end

	// TODO: API logic..
}
```
</TabItem>
<TabItem value="gin">

```go
import (
	"net/http"

	"github.com/gin-gonic/gin"
	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/recipe/session/sessmodels"
)

func main() {
	router := gin.New()

	//highlight-next-line
	router.GET("/sessioninfo", verifySession(nil), sessioninfo)
}

// Wrap session.VerifySession to work with Gin
//highlight-start
func verifySession(options *sessmodels.VerifySessionOptions) gin.HandlerFunc {
	return func(c *gin.Context) {
		session.VerifySession(options, func(rw http.ResponseWriter, r *http.Request) {
			c.Request = c.Request.WithContext(r.Context())
			c.Next()
		})(c.Writer, c.Request)
		// we call Abort so that the next handler in the chain is not called, unless we call Next explicitly
		c.Abort()
	}
}

//highlight-end

// This is the API handler.
func sessioninfo(c *gin.Context) {
	// Fetching the session object and reading the userID
	//highlight-start
	sessionContainer := session.GetSessionFromRequestContext(c.Request.Context())
	userId := sessionContainer.GetUserID()
	//highlight-end

	// TODO: API logic..
}

```

</TabItem>
<TabItem value="chi">

```go
import (
	"net/http"

	"github.com/go-chi/chi"
	"github.com/supertokens/supertokens-golang/recipe/session"
)

func main() {
	r := chi.NewRouter()

	//highlight-next-line
	r.Get("/sessioninfo", session.VerifySession(nil, sessioninfo))
}

// This is the API handler.
func sessioninfo(w http.ResponseWriter, r *http.Request) {
	// Fetching the session object and reading the userID
	//highlight-start
	sessionContainer := session.GetSessionFromRequestContext(r.Context())
	userId := sessionContainer.GetUserID()
	//highlight-end

	// TODO: API logic..
}
```

</TabItem>
<TabItem value="mux">

```go
import (
	"net/http"

	"github.com/gorilla/mux"
	"github.com/supertokens/supertokens-golang/recipe/session"
)

func main() {
	router := mux.NewRouter()

	//highlight-start
	router.HandleFunc("/sessioninfo", 
        session.VerifySession(nil, sessioninfo))
            .Methods(http.MethodGet)
    //highlight-end
}

// This is the API handler.
func sessioninfo(w http.ResponseWriter, r *http.Request) {
	// Fetching the session object and reading the userID
	//highlight-start
	sessionContainer := session.GetSessionFromRequestContext(r.Context())
	userId := sessionContainer.GetUserID()
	//highlight-end

	// TODO: API logic..
}
```

</TabItem>
</GoFrameworkSubTabs>
</TabItem>
</BackendSDKTabs>

---------------

## Minimum setup completed 🎉🥳
Congratulations! You now have a fully functional session system!

The next steps is to setup your SuperTokens core instance.