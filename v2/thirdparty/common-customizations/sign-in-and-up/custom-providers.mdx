---
id: custom-providers
title: Custom providers
show_ui_switcher: true
---

import {PreBuiltOrCustomUISwitcher, PreBuiltUIContent, CustomUIContent} from "/src/components/preBuiltOrCustomUISwitcher"
import FrontendSDKTabs from "/src/components/tabs/FrontendSDKTabs"
import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs"
import TabItem from '@theme/TabItem';

If SuperTokens doesn't support a provider out of the box, you can use custom providers to add a new third party provider to your application. 

:::note
If you think that this provider should be supported by SuperTokens by default, make sure to let us know [here](https://github.com/supertokens/supertokens-node/issues/88).
:::

## Frontend

<PreBuiltOrCustomUISwitcher>

<PreBuiltUIContent>

<FrontendSDKTabs>
<TabItem value="reactjs">

```tsx
import React from "react";
import SuperTokens from "supertokens-auth-react";
import ThirdParty from "supertokens-auth-react/recipe/thirdparty";
SuperTokens.init({
    appInfo: {
        apiDomain: "...",
        appName: "...",
        websiteDomain: "..."
    },
    recipeList: [
        ThirdParty.init({
            signInAndUpFeature: {
                // highlight-start
                providers: [
                    {
                        id: "custom",
                        name: "X", // Will display "Continue with X"

                        // optional
                        // you do not need to add a click handler to this as
                        // we add it for you automatically.
                        buttonComponent: <div style={{
                            cursor: "pointer",
                            border: "1",
                            paddingTop: "5px",
                            paddingBottom: "5px",
                            borderRadius: "5px",
                            borderStyle: "solid"
                        }}>Login with Custom</div>
                    }
                ],
                // highlight-end
                // ...
            },
            // ...
        }),
        // ...
    ]
});
```
</TabItem>
</FrontendSDKTabs>

</PreBuiltUIContent>

<CustomUIContent>

Refer [this page](../../custom-ui/thirdparty-login) for the implementation.

</CustomUIContent>

</PreBuiltOrCustomUISwitcher>

## Backend

:::note 
The OAuth callback URL for your custom provider will be `{websiteDomain}{websiteBasePath}/callback/{customId}`, where `customId` is the `id` given in the config below (the value below is `"custom"`).
:::

You can create a custom provider by providing values for `AuthorizationEndpoint`, `TokenEndpoint`, `UserInfoEndpoint`, `UserInfoMap`.

`AuthorizationEndpoint` corresponds to the URL to which the user should be redirected to for the login.

`TokenEndpoint` corresponds to the API that is used to exchange `Authorization Code` for the user's `Access Token` or the `ID Token`.

`UserInfoEndpoint` corresponds to the API that providers user information using the `AccessToken`.

`UserInfoMap` specifies the fields (keys) on the response from the provider which can be used to extract essential information, such as `UserId`, `Email` and `EmailVerified`.

User info can be fetched in two ways:

1. From the UserInfoEndpoint

    In this approach, the SDK will query the `UserInfoEndpoint` and fetch the user details. For this to work, `UserInfoMap.FromUserInfoAPI` must be specified.

2. From the ID token payload

    In this approach, the SDK will fetch the user info from the ID token payload, validating it against the `JwksURI` configuration. For this to work, `UserInfoMap.FromIdTokenPayload` must be specified.

Here is an example on how to setup a custom provider:

<BackendSDKTabs>
<TabItem value="nodejs">

```tsx
TODO
```

</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/thirdparty"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	supertokens.Init(supertokens.TypeInput{
		RecipeList: []supertokens.Recipe{
			thirdparty.Init(&tpmodels.TypeInput{
				SignInAndUpFeature: tpmodels.TypeInputSignInAndUp{
					Providers: []tpmodels.ProviderInput{
						{
							// highlight-start
							Config: tpmodels.ProviderConfig{
								ThirdPartyId: "custom",
								Name:         "Custom provider",
								Clients: []tpmodels.ProviderClientConfig{
									{
										ClientID:     "...",
										ClientSecret: "...",
										Scope:        []string{"profile", "email"},
									},
								},
								AuthorizationEndpoint: "https://example.com/oauth/authorize",
								TokenEndpoint:         "https://example.com/oauth/token",
								UserInfoEndpoint:      "https://example.com/oauth/userinfo",
								UserInfoMap: tpmodels.TypeUserInfoMap{
									FromUserInfoAPI: tpmodels.TypeUserInfoFields{
										UserId:        "id",
										Email:         "email",
										EmailVerified: "email_verified",
									},
								},
							},
							// highlight-end
						},
					},
				},
			}),
		},
	})
}
```

</TabItem>
<TabItem value="python">

```python
TODO
```

</TabItem>
</BackendSDKTabs>

If the provider is Open ID Connect (OIDC) compatible, you can provide url for the `OIDCDiscoverEndpoint` config. The backend SDK will automatically discover authorization endpoint, token endpoint and the user info endpoint by querying the `<OIDCDiscoverEndpoint>/.well-known/openid-configuration`.

Below is an example of how to set the OIDC discovery endpoint:

<BackendSDKTabs>
<TabItem value="nodejs">

```tsx
TODO
```

</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/thirdparty"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	supertokens.Init(supertokens.TypeInput{
		RecipeList: []supertokens.Recipe{
			thirdparty.Init(&tpmodels.TypeInput{
				SignInAndUpFeature: tpmodels.TypeInputSignInAndUp{
					Providers: []tpmodels.ProviderInput{
						{
							Config: tpmodels.ProviderConfig{
								ThirdPartyId: "custom",
								Name:         "Custom provider",
								Clients: []tpmodels.ProviderClientConfig{
									{
										ClientID:     "...",
										ClientSecret: "...",
										Scope:        []string{"profile", "email"},
									},
								},
								// highlight-start
								OIDCDiscoveryEndpoint: "https://example.com/openid",
								// highlight-end
								UserInfoMap: tpmodels.TypeUserInfoMap{
									FromUserInfoAPI: tpmodels.TypeUserInfoFields{
										UserId:        "id",
										Email:         "email",
										EmailVerified: "email_verified",
									},
								},
							},
						},
					},
				},
			}),
		},
	})
}
```

</TabItem>
<TabItem value="python">

```python
TODO
```

</TabItem>
</BackendSDKTabs>

### Modifying params sent to token or authorization endpoint

Sometimes, the custom provider might need a different set of parameters to be passed to the `AuthorizationEndpoint` and `TokenEndpoint`, other than what the SDK passes by default.

For example, you may want to use a different value for `"response_type"`, or a dynamic value based on request for `"login_hint"` or an additional parameter like `"response_mode"`. It can be achieved as shown below:

<BackendSDKTabs>
<TabItem value="nodejs">

```tsx
import SuperTokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdParty from "supertokens-node/recipe/thirdparty";

TODO

SuperTokens.init({
    appInfo: {
        apiDomain: "...",
        appName: "...",
        websiteDomain: "..."
    },
    supertokens: {
        connectionURI: "...",
    },
    recipeList: [
        ThirdParty.init({
            signInAndUpFeature: {
                // highlight-start
                providers: [
                    {
                        id: "custom",
                        get: (redirectURI, authCodeFromRequest) => {
                            return {
                                accessTokenAPI: {
                                    // this contains info about the token endpoint which exchanges the auth code with the access token and profile info.
                                    url: "https://oauth.example.com/token",
                                    params: {
                                        // example post params
                                        client_id: "<CLIENT ID>",
                                        client_secret: "<CLIENT SECRET>",
                                        grant_type: "authorization_code",
                                        redirect_uri: redirectURI || "",
                                        code: authCodeFromRequest || "",
                                        //...
                                    }
                                },
                                authorisationRedirect: {
                                    // this contains info about forming the authorisation redirect URL without the state params and without the redirect_uri param
                                    url: "https://oauth.example.com",
                                    params: {
                                        client_id: "<CLIENT ID>",
                                        scope: "<SCOPES>",
                                        response_type: "code",
                                        //...
                                    }
                                },
                                getClientId: () => {
                                    return "<CLIENT ID>";
                                },
                                getProfileInfo: async (accessTokenAPIResponse) => {
                                    /* accessTokenAPIResponse is the JSON response from the accessTokenAPI POST call. Using this, you need to return an object of the following type:
                                    {
                                        id: string, // user ID as provided by the third party provider
                                        email?: { // optional 
                                            id: string, // emailID
                                            isVerified: boolean // true if the email is verified already
                                        }
                                    }
                                    */
                                    return {
                                        id: "..."
                                    };
                                }
                            }
                        }
                    }
                ]
                // highlight-end
            }
        }),
        Session.init({})
    ]
});
```

</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/thirdparty"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	supertokens.Init(supertokens.TypeInput{
		RecipeList: []supertokens.Recipe{
			thirdparty.Init(&tpmodels.TypeInput{
				SignInAndUpFeature: tpmodels.TypeInputSignInAndUp{
					Providers: []tpmodels.ProviderInput{
						{
							Config: tpmodels.ProviderConfig{
								ThirdPartyId: "custom",
								Clients: []tpmodels.ProviderClientConfig{
									{
										ClientID:     "...",
										ClientSecret: "...",
										Scope:        []string{"profile", "email"},
									},
								},
								AuthorizationEndpoint: "https://example.com/oauth/authorize",
								TokenEndpoint:         "https://example.com/oauth/token",
								// highlight-start
								AuthorizationEndpointQueryParams: map[string]interface{}{
									"response_type": "token", // Changing an existing parameter
									"response_mode": "form", // Adding a new parameter
									"scope":         nil,    // Removing a parameter
								},
								TokenEndpointBodyParams: map[string]interface{}{
									"foo": "bar", // Adding a new parameter
								},
								// highlight-end
								UserInfoEndpoint: "https://example.com/oauth/userinfo",
								UserInfoMap: tpmodels.TypeUserInfoMap{
									FromUserInfoAPI: tpmodels.TypeUserInfoFields{
										UserId:        "id",
										Email:         "email",
										EmailVerified: "email_verified",
									},
								},
							},
						},
					},
				},
			}),
		},
	})
}
```

</TabItem>
<TabItem value="python">

```python
from supertokens_python import init, InputAppInfo
from supertokens_python.recipe import thirdparty
from supertokens_python.recipe.thirdparty.provider import Provider
from supertokens_python.recipe.thirdparty.types import UserInfo, AccessTokenAPI, AuthorisationRedirectAPI
from typing import Dict, Union, Any
from supertokens_python.recipe.thirdparty.types import UserInfo, UserInfoEmail

TODO

class CustomProvider(Provider):
    def __init__(self):
        super().__init__('<PROVIDER_ID>', False)

    async def get_profile_info(self, auth_code_response: Dict[str, Any], user_context: Dict[str, Any]) -> UserInfo:
        # TODO: fetch user info from provider based on auth_code_response
        return UserInfo(user_id="...", email=UserInfoEmail(email="..", email_verified=True))

    def get_authorisation_redirect_api_info(self, user_context: Dict[str, Any]) -> AuthorisationRedirectAPI:
        params: Dict[str, Any] = {
            'scope': '<SCOPES>',
            'response_type': 'code',
            'client_id': "<CLIENT ID>",
        }
        return AuthorisationRedirectAPI(url="https://oauth.example.com", params=params)

    def get_access_token_api_info(
            self, redirect_uri: str, auth_code_from_request: str, user_context: Dict[str, Any]) -> AccessTokenAPI:
        params = {
            'client_id': "<CLIENT ID>",
            'client_secret': "<CLIENT SECRET>",
            'grant_type': 'authorization_code',
            'code': auth_code_from_request,
            'redirect_uri': redirect_uri
        }
        return AccessTokenAPI(url="https://oauth.example.com/token", params=params)

    def get_redirect_uri(self, user_context: Dict[str, Any]) -> Union[None, str]:
        return None
    
    def get_client_id(self, user_context: Dict[str, Any]) -> str:
        return "<CLIENT ID>"


init(
    app_info=InputAppInfo(api_domain="...", app_name="...", website_domain="..."),
    framework='...', # type: ignore
    recipe_list=[
        thirdparty.init(
            # highlight-start
            sign_in_and_up_feature=thirdparty.SignInAndUpFeature(providers=[
                CustomProvider()
            ])
            # highlight-end
        )
    ]
)
```

</TabItem>
</BackendSDKTabs>

### Overriding default provider functions

SuperTokens has default implementation for all providers that relies on the config that you specify above. For example, the API call made to get the user's profile info makes a `GET` call to the `UserInfoEndpoint` with the user's access token. If your provider requires a different method or requires multiple calls to different endpoints to get the profile info, then you can override the default implementation as shown below:

The original implementation has 4 functions which can be overidden:

1. `GetConfigForClientType`

    Selects the client config from the list of clients provided and returns the complete provider config. This is a good place to override config dynamically. For example, if `login_hint` is provided in the request, it can be added to the `AuthorizationEndpointQueryParams`.

2. `GetAuthorisationRedirectURL`

    This functions determines the query parameters that needs to be added to the `AuthorizationEndpoint` which can be used to redirect the user for the provider login.

3. `ExchangeAuthCodeForOAuthTokens`

    This function is responsible for exchanging one time use `Authorization Code` with the user's tokens, such as `Access Token`, 'ID Token', etc.

4. `GetUserInfo`

    This function is responsible for fetching the user information such as `UserId`, `Email` and `EmailVerified` using the tokens returned from the previous function.

Here's an example of you can override `GetUserInfo`. All the above mentioned functions can be overridden in a similar way:

<BackendSDKTabs>
<TabItem value="nodejs">

```tsx
import SuperTokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdParty from "supertokens-node/recipe/thirdparty";

TODO

SuperTokens.init({
    appInfo: {
        apiDomain: "...",
        appName: "...",
        websiteDomain: "..."
    },
    supertokens: {
        connectionURI: "...",
    },
    recipeList: [
        ThirdParty.init({
            signInAndUpFeature: {
                // highlight-start
                providers: [
                    {
                        id: "custom",
                        get: (redirectURI, authCodeFromRequest) => {
                            return {
                                accessTokenAPI: {
                                    // this contains info about the token endpoint which exchanges the auth code with the access token and profile info.
                                    url: "https://oauth.example.com/token",
                                    params: {
                                        // example post params
                                        client_id: "<CLIENT ID>",
                                        client_secret: "<CLIENT SECRET>",
                                        grant_type: "authorization_code",
                                        redirect_uri: redirectURI || "",
                                        code: authCodeFromRequest || "",
                                        //...
                                    }
                                },
                                authorisationRedirect: {
                                    // this contains info about forming the authorisation redirect URL without the state params and without the redirect_uri param
                                    url: "https://oauth.example.com",
                                    params: {
                                        client_id: "<CLIENT ID>",
                                        scope: "<SCOPES>",
                                        response_type: "code",
                                        //...
                                    }
                                },
                                getClientId: () => {
                                    return "<CLIENT ID>";
                                },
                                getProfileInfo: async (accessTokenAPIResponse) => {
                                    /* accessTokenAPIResponse is the JSON response from the accessTokenAPI POST call. Using this, you need to return an object of the following type:
                                    {
                                        id: string, // user ID as provided by the third party provider
                                        email?: { // optional 
                                            id: string, // emailID
                                            isVerified: boolean // true if the email is verified already
                                        }
                                    }
                                    */
                                    return {
                                        id: "..."
                                    };
                                }
                            }
                        }
                    }
                ]
                // highlight-end
            }
        }),
        Session.init({})
    ]
});
```

</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/thirdparty"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	supertokens.Init(supertokens.TypeInput{
		RecipeList: []supertokens.Recipe{
			thirdparty.Init(&tpmodels.TypeInput{
				SignInAndUpFeature: tpmodels.TypeInputSignInAndUp{
					Providers: []tpmodels.ProviderInput{
						{
							Config: tpmodels.ProviderConfig{
								ThirdPartyId: "custom",
								Clients: []tpmodels.ProviderClientConfig{
									{
										ClientID:     "...",
										ClientSecret: "...",
										Scope:        []string{"profile", "email"},
									},
								},
								AuthorizationEndpoint: "https://example.com/oauth/authorize",
								AuthorizationEndpointQueryParams: map[string]interface{}{
									"response_type": "token", // Changing an existing parameter
									"response_mode": "form", // Adding a new parameter
									"scope":         nil,    // Removing a parameter
								},
								TokenEndpoint: "https://example.com/oauth/token",
							},
							// highlight-start
							Override: func(originalImplementation *tpmodels.TypeProvider) *tpmodels.TypeProvider {
								// ...
								originalImplementation.GetUserInfo = func(config tpmodels.ProviderConfigForClientType, oAuthTokens tpmodels.TypeOAuthTokens, userContext supertokens.UserContext) (tpmodels.TypeUserInfo, error) {
									// Call provider's APIs to get profile info
									// ...
									return tpmodels.TypeUserInfo{
										ThirdPartyUserId: "...",
										Email: &tpmodels.EmailStruct{
											ID:         "...",
											IsVerified: true,
										},
										RawUserInfoFromProvider: tpmodels.TypeRawUserInfoFromProvider{
											FromUserInfoAPI: map[string]interface{}{
												"first_name": "...",
												"last_name":  "...",
												// ...
											},
										},
									}, nil
								}
								return originalImplementation
							},
							// highlight-end
						},
					},
				},
			}),
		},
	})
}
```

</TabItem>
<TabItem value="python">

```python
from supertokens_python import init, InputAppInfo
from supertokens_python.recipe import thirdparty
from supertokens_python.recipe.thirdparty.provider import Provider
from supertokens_python.recipe.thirdparty.types import UserInfo, AccessTokenAPI, AuthorisationRedirectAPI
from typing import Dict, Union, Any
from supertokens_python.recipe.thirdparty.types import UserInfo, UserInfoEmail

TODO

class CustomProvider(Provider):
    def __init__(self):
        super().__init__('<PROVIDER_ID>', False)

    async def get_profile_info(self, auth_code_response: Dict[str, Any], user_context: Dict[str, Any]) -> UserInfo:
        # TODO: fetch user info from provider based on auth_code_response
        return UserInfo(user_id="...", email=UserInfoEmail(email="..", email_verified=True))

    def get_authorisation_redirect_api_info(self, user_context: Dict[str, Any]) -> AuthorisationRedirectAPI:
        params: Dict[str, Any] = {
            'scope': '<SCOPES>',
            'response_type': 'code',
            'client_id': "<CLIENT ID>",
        }
        return AuthorisationRedirectAPI(url="https://oauth.example.com", params=params)

    def get_access_token_api_info(
            self, redirect_uri: str, auth_code_from_request: str, user_context: Dict[str, Any]) -> AccessTokenAPI:
        params = {
            'client_id': "<CLIENT ID>",
            'client_secret': "<CLIENT SECRET>",
            'grant_type': 'authorization_code',
            'code': auth_code_from_request,
            'redirect_uri': redirect_uri
        }
        return AccessTokenAPI(url="https://oauth.example.com/token", params=params)

    def get_redirect_uri(self, user_context: Dict[str, Any]) -> Union[None, str]:
        return None
    
    def get_client_id(self, user_context: Dict[str, Any]) -> str:
        return "<CLIENT ID>"


init(
    app_info=InputAppInfo(api_domain="...", app_name="...", website_domain="..."),
    framework='...', # type: ignore
    recipe_list=[
        thirdparty.init(
            # highlight-start
            sign_in_and_up_feature=thirdparty.SignInAndUpFeature(providers=[
                CustomProvider()
            ])
            # highlight-end
        )
    ]
)
```

</TabItem>
</BackendSDKTabs>


<!-- COPY SECTION -->
<!-- ./thirdparty/common-customizations/sign-in-and-up/built-in-providers.mdx -->
<!-- 1 -->

## See also
- [Get the third party provider's access token](../../post-login/getting-provider-access-token)
- [Get the user info from the third party provider](../getting-provider-user-profile)
- [Multi-tenancy SSO (Okta, AD, SAML, Google Workspaces)](../TODO)

<!-- END COPY SECTION -->
