---
id: backend-config
title: 2. Backend config
hide_title: true
---

<!-- COPY SECTION -->
<!-- ./emailpassword/serverless/with-aws-lambda/backend-config.mdx -->
<!-- 1 -->

import AppInfoForm from "/src/components/appInfoForm"
import CoreInjector from "/src/components/coreInjector"
import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';

# 2. Backend config

## 1) Create Lambda layer with required libraries

<BackendSDKTabs disableGolang>
<TabItem value="nodejs">

```bash
mkdir lambda && cd lambda

npm i -s supertokens-node @middy/core @middy/http-cors
mdkir nodejs && cp -r node_modules nodejs
zip -r supertokens-node.zip nodejs/
```

</TabItem>
<TabItem value="python">

```bash
mkdir lambda && cd lambda

pip install --target ./python fastapi uvicorn mangum nest_asyncio supertokens-python
cd python && rm -r *dist-info **/__pycache__ && cd ..
zip -r supertokens-python.zip python/
```

</TabItem>
</BackendSDKTabs>

## 2) Upload SuperTokens lambda layer
- Open AWS Lambda dashboard and click on layers:
<img src="https://user-images.githubusercontent.com/20884782/190074706-3d1b6420-e812-48d9-aa04-8ea2d4a4c62d.png" height="300" />

- Click "Create Layer" button:
<img src="https://user-images.githubusercontent.com/20884782/190075143-57768a61-7efc-4b3d-a865-0d68e84f3005.png" width="600" />

- Give a name for your layer, upload the zip and select the runtime
<img src="https://user-images.githubusercontent.com/20884782/190076214-47e1ba13-3f17-4dcb-afc9-90b3e8c0f53c.png" height="600" />

## 3) Link lambda layer with lambda function

- Scroll to the bottom and look for the `Layers` tab. Click on `Add a layer`
<img src="https://user-images.githubusercontent.com/20884782/190076987-02e9f585-d870-4dac-bd96-d55ce71596c4.png" width="700"/>

- Select `Custom Layer` and then select the layer we created in the first step:
<img src="https://user-images.githubusercontent.com/20884782/190077385-55f9db2f-190b-42ed-ab09-70d94ec3b7a3.jpg" height="500" />

<!-- END COPY SECTION -->

## 4) Create a backend config file

Using the editor provided by AWS, create a new config file and write the following code:


<AppInfoForm
    askForAppName
    askForAPIDomain
    askForWebsiteDomain
>

<CoreInjector>

<BackendSDKTabs disableGolang>
<TabItem value="nodejs">

```tsx title="config.js"

import ThirdParty from 'supertokens-node/recipe/thirdparty';
import Session from 'supertokens-node/recipe/session'

function getBackendConfig() {
  return {
    framework: "awsLambda",
    supertokens: {
      ^{coreInjector_connection_uri_comment}
      connectionURI: ^{coreInjector_uri}
      ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
      // learn more about this on https://supertokens.com/docs/thirdparty/appinfo
      appName: "^{form_appName}",
      apiDomain: "^{form_apiDomain}",
      websiteDomain: "^{form_websiteDomain}",
      apiBasePath: "^{form_apiBasePath}",
      websiteBasePath: "^{form_websiteBasePath}",
      apiGatewayPath: "/dev" // TODO: same as what's set on the frontend config
    },
    recipeList: [
      ThirdParty.init({
        signInAndUpFeature: {
          providers: [
            // We have provided you with development keys which you can use for testing.
            // IMPORTANT: Please replace them with your own OAuth keys for production use.
            ThirdParty.Google({
              clientId: "^{googleClientId}",
              clientSecret: "^{googleClientSecret}",
            }),
            ThirdParty.Github({
              clientId: "^{githubClientId}",
              clientSecret: "^{githubClientSecret}",
            }),
            ThirdParty.Apple({
              clientId: "^{appleClientId}",
              clientSecret: {
                  keyId: "^{appleKeyId}",
                  privateKey: "^{applePrivateKey}",
                  teamId: "^{appleTeamId}",
              },
            }),
            // ThirdParty.Facebook({
            //   clientSecret: "^{facebookClientSecret}",
            //   clientId: "^{facebookClientId}",
            // })
          ]
        }
      }),
      Session.init(),
    ],
    isInServerlessEnv: true,
  }
}

module.exports.getBackendConfig = getBackendConfig;
```
</TabItem>

<TabItem value="python">

```python title="config.py"
from supertokens_python import SupertokensConfig, InputAppInfo
from supertokens_python.recipe import session, thirdparty
from supertokens_python.recipe.thirdparty import Google, Facebook, Github, Apple

supertokens_config=SupertokensConfig(
    ^{coreInjector_connection_uri_comment_with_hash}
    connection_uri=^{coreInjector_uri}
    ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
)

app_info=InputAppInfo(
    # learn more about this on https://supertokens.com/docs/thirdparty/appinfo
    app_name="^{form_appName}",
    api_domain="^{form_apiDomain}",
    website_domain="^{form_websiteDomain}",
    api_base_path="^{form_apiBasePath}",
    website_base_path="^{form_websiteBasePath}",
    api_gateway_path="/dev",
)

framework="fastapi"

recipe_list=[
    session.init(),
    thirdparty.init(
      sign_in_and_up_feature=thirdparty.SignInAndUpFeature(providers=[
        # We have provided you with development keys which you can use for testing.
        # IMPORTANT: Please replace them with your own OAuth keys for production use.
        Google(
            client_id='^{googleClientId}',
            client_secret='^{googleClientSecret}'
        # ), Facebook(
        #     client_id='^{facebookClientId}',
        #     client_secret='^{facebookClientSecret}'
        ), Github(
            client_id='^{githubClientId}',
            client_secret='^{githubClientSecret}'
        ),
        Apple(
            client_id="^{appleClientId}",
            client_key_id="^{appleKeyId}",
            client_private_key="^{applePrivateKey}",
            client_team_id="^{appleTeamId}"
        )
    ])
    ),
]
```

</TabItem>

</BackendSDKTabs>

</CoreInjector>

</AppInfoForm>


