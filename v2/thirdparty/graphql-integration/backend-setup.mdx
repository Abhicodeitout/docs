---
id: backend-setup
title: 1. Backend Setup
hide_title: true
show_ui_switcher: true
---

<!-- COPY DOCS -->
<!-- ./thirdpartyemailpassword/graphql-integration/backend-setup.mdx -->

import {PreBuiltOrCustomUISwitcher, PreBuiltUIContent, CustomUIContent} from "/src/components/preBuiltOrCustomUISwitcher"

# Backend Setup

## a) Complete the setup guides

<PreBuiltOrCustomUISwitcher>

<PreBuiltUIContent>

Follow the [frontend and backend pre-built UI setup guides](../pre-built-ui/setup/frontend) to setup SuperTokens.

</PreBuiltUIContent>

<CustomUIContent>

Follow the [frontend and backend custom UI setup guides](../custom-ui/init/frontend) to setup SuperTokens.

</CustomUIContent>

</PreBuiltOrCustomUISwitcher>

## b) Install GraphQL dependencies on your backend

:::info
We use Apollo server in this example, SuperTokens can be used with other GraphQL libraries as well.
:::

```bash
npm install @apollo/server graphql
```

## c) Setup GraphQL

### Create a schema 

```tsx
const typeDefs = `#graphql
  type Query {
      verify: String,
  }
`
```

### Create resolvers

```tsx
const resolvers = {
    Query: {
        verify: async (_: any, __: any, contextValue: any) => {
            await Session.getSession(contextValue.req, contextValue.res);
            return "Session verified";
        }
    }
}
```

Refer to the [official Apollo guide](https://www.apollographql.com/docs/apollo-server/getting-started) to know more.

## d) Add a GraphQL endpoint with optional session verification

```tsx
import { ApolloServer } from "@apollo/server";
import express from "express";
import { expressMiddleware } from "@apollo/server/express4";

const typeDefs = '' // Refer to previous step
const resolvers = {} // Refer to previous step

const server = new ApolloServer({
    typeDefs,
    resolvers,
    plugins: [
        {
            requestDidStart: async () => {
                return {
                    didEncounterErrors: async (requestContext) => {
                        const {req, res} = requestContext.contextValue as any;
                        for (let i = 0; i < requestContext.errors.length; i++) {
                            let error = requestContext.errors[i].originalError;
                            await new Promise(async (resolve) => {
                                // This will handle any session or other SuperTokens related errors
                                await errorHandler()(error, req, res, (err) => {
                                    resolve(undefined);
                                });
                            });
                        }
                    },
                };
            }
        }
    ],
})

server.start().then(() => {
    // Use expressMiddleware only after server.start has resolved
    app.use(express.json(), expressMiddleware(server, {
        context: async ({req, res}) => {
            return {
              // We add this so that we can access sessions in the resolvers
                req,
                res,
            };
        },
    }))

    app.listen(3001, () => {
        console.log("Server started");
    })
})
```

Refer to [this page](../common-customizations/sessions/session-verification-in-api/verify-session#the-session-object) to know more about the session object
