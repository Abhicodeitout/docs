---
id: multitenant-login
title: "Multitenant and Enterprise SSO login"
hide_title: true
---

import AppInfoForm from "/src/components/appInfoForm"
import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import PythonSyncAsyncSubTabs from "/src/components/tabs/PythonSyncAsyncSubTabs";
import GoFrameworkSubTabs from "/src/components/tabs/GoFrameworkSubTabs";
import FrontendCustomUITabs from "/src/components/tabs/FrontendCustomUITabs"
import FrontendMobileSubTabs from "/src/components/tabs/FrontendMobileSubTabs"
import NpmOrScriptTabs from "/src/components/tabs/NpmOrScriptTabs"

import TabItem from '@theme/TabItem';
import MultiTenancyPaidBanner from '../../community/reusableMD/multitenancy/MultiTenancyPaidBanner.mdx'
import CoreInjector from "/src/components/coreInjector"

<!-- COPY SECTION -->
<!-- ./thirdparty/pre-built-ui/multitenant-login.mdx  -->
<!-- 1 -->

<MultiTenancyPaidBanner />

# Multitenant and Enterprise SSO login

Multitenant login is a feature that let's you customize login experience for each of your customers. For example, a customer `customer1` hosted on `customer1.yourdomain.com` can have login with `Active Directory` and `Google`, and another customer `customer2` hosted on `customer2.yourdomain.com` can have login with `Okta` and `Facebook`.

This is also the page that you should see if you want to implement sign in with:
- Okta (`thirdPartyId: "okta"`)
- SAML (`thirdPartyId: "boxy-saml"`)
- Active Directory (`thirdPartyId: "active-directory"`)
- Google Workspaces (`thirdPartyId: "google-workspaces"`)
- Or any other workforce IdP

<!-- END COPY SECTION -->

<!-- COPY SECTION -->
<!-- ./thirdparty/pre-built-ui/multitenant-login.mdx  -->
<!-- 2 -->

## Step 1: Create and configure a new tenant in SuperTokens core

Each tenant can be configured with a unique `tenantId`, and the list of third party connections (Active Directory, Google etc..) that should be allowed for them. 

You can create a new tenant using our backend SDKs or via a `cURL` command to the core.

<BackendSDKTabs enableCurl>

<TabItem value="nodejs">

```tsx
TODO
```

</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/multitenancy"
	"github.com/supertokens/supertokens-golang/recipe/multitenancy/multitenancymodels"
)

func main() {
	tenantId := "customer1"
	thirdpartyEnabled := true

  // highlight-start
	resp, err := multitenancy.CreateOrUpdateTenant(&tenantId, multitenancymodels.TenantConfig{
		ThirdpartyEnabled: &thirdpartyEnabled,
	})
  // highlight-end

	if err != nil {
		// handle error
	}
	if resp.OK.CreatedNew {
		// new tenant was created
	} else {
		// existing tenant's config was modified.
	}
}
```

</TabItem>
<TabItem value="python">

<PythonSyncAsyncSubTabs>
<TabItem value="asyncio">

```python
TODO
```

</TabItem>

<TabItem value="syncio">

```python
TODO
```

</TabItem>
</PythonSyncAsyncSubTabs>

</TabItem>

<TabItem value="curl">

<CoreInjector defaultValue="http://localhost:3567">

```bash
curl --location --request PUT '^{coreInjector_uri_without_quotes}/recipe/multitenancy/tenant' \
--header 'api-key: ^{coreInjector_api_key_without_quotes}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "tenantId": "customer1",
    "thirdpartyEnabled": true
}'
```

</CoreInjector>

</TabItem>

</BackendSDKTabs>

Once a tenant is created, add their thirdparty providers as shown below.

<BackendSDKTabs enableCurl>

<TabItem value="nodejs">

```tsx
TODO
```

</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/multitenancy"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
)

func main() {
	tenantId := "customer1"

	// highlight-start
	resp, err := multitenancy.CreateOrUpdateThirdPartyConfig(tpmodels.ProviderConfig{
		TenantId:     &tenantId,
		ThirdPartyId: "active-directory",
		Name:         "Active Directory",
		Clients: []tpmodels.ProviderClientConfig{
			{
				ClientID:     "...",
				ClientSecret: "...",
				AdditionalConfig: map[string]interface{}{
					"directoryId": "...",
				},
			},
		},
	})
	// highlight-end

	if err != nil {
		// handle error
	}
	if resp.OK.CreatedNew {
		// Active Directory added to customer1
	} else {
		// Existing active directory config overwritten for customer1
	}
}
```

</TabItem>
<TabItem value="python">

<PythonSyncAsyncSubTabs>
<TabItem value="asyncio">

```python
TODO
```

</TabItem>

<TabItem value="syncio">

```python
TODO
```

</TabItem>
</PythonSyncAsyncSubTabs>

</TabItem>

<TabItem value="curl">

<CoreInjector defaultValue="http://localhost:3567">

```bash
curl --location --request PUT '^{coreInjector_uri_without_quotes}/recipe/multitenancy/config/thirdparty' \
--header 'api-key: ^{coreInjector_api_key_without_quotes}' \
--header 'Content-Type: application/json' \
--data-raw '{
  "config": {
    "tenantId": "customer1",
    "thirdPartyId": "active-directory",
    "name": "Active Directory",
    "clients": [
      {
        "clientId": "...",
        "clientSecret": "...",
        "additionalConfig": {
          "directoryId": "..."
        }
      }
    ]
  }
}'
```

</CoreInjector>

</TabItem>

</BackendSDKTabs>

:::important
The above shows how to add an Active Directory config for the `customer1` tenant. You can see the config structure for all the in built providers [on this page](./TODO).
:::

<!-- END COPY SECTION -->

## Step 2: Frontend setup

The frontend setup is similar to that of a [regular single tenant social login page](./thirdparty-login), but on page load, you will first need to check which third party providers are enabled for the current tenant. This can be done by querying the backend as shown below:

<FrontendCustomUITabs>
<TabItem value="web">

<NpmOrScriptTabs>
<TabItem value="npm">

```tsx
TODO
import SuperTokens from 'supertokens-web-js';

async function fetchThirdPartyLoginProvidersForTenant(tenantId: string) {
	const loginMethods = await SuperTokens.getLoginMethods({
		tenantId
	})

	if (loginMethods.thirdParty.enabled) {
		const providers = loginMethods.thirdParty.providers;
		if (providers.find(i => i.thirdPartyId === "active-directory")) {
			// render sign in with Active Directory button
		} else {
			// more checks for other providers
		}
	} else {
		// thirdparty login is disabled for the tenant
	}
}
```

</TabItem>
<TabItem value="script">

```tsx
TODO
import supertokens from 'supertokens-web-js-script';
async function fetchThirdPartyLoginProvidersForTenant(tenantId: string) {
	const loginMethods = await supertokens.getLoginMethods({
		tenantId
	})

	if (loginMethods.thirdParty.enabled) {
		const providers = loginMethods.thirdParty.providers;
		if (providers.find(i => i.thirdPartyId === "active-directory")) {
			// render sign in with Active Directory button
		} else {
			// more checks for other providers
		}
	} else {
		// thirdparty login is disabled for the tenant
	}
}
```

</TabItem>
</NpmOrScriptTabs>

Once you have the list of third party providers for the current tenant, you can display the relevant buttons on the page.

When the user clicks on a specific provider, you would need to follow the same steps mentioned in the [single tenant social login page](./thirdparty-login). The only addition is that when calling `getAuthorisationURLWithQueryParamsAndSetState`, you would also need to pass in the `tenantId`.

</TabItem>

<TabItem value="mobile">

<AppInfoForm askForAPIDomain>

Once you have the authorisation code from the auth provider, you need to call the signinup API exposed by our backend SDK as shown below:

```bash
curl --location --request GET '^{form_apiDomain}^{form_apiBasePath}/loginmethods?tenantId=customer1' \
--header 'rid: multitenancy'
```

The response body from the API call has a `status` property in it:
- `status: "OK"`: The `recipes` field will contain information about which login methods are enabled along with the list of third party providers configured for this tenant.
- `status: "GENERAL_ERROR"`: This is only possible if you have overriden the backend API to send back a custom error message which should be displayed on the frontend.

</AppInfoForm>

Once you have the list of third party providers for the current tenant, you can display the relevant buttons on the page.

When the user clicks on a specific provider, you would need to follow the same steps mentioned in the [single tenant social login page](./thirdparty-login). The only addition is that when calling `/auth/signinup POST` API, you would also need to pass in the `tenantId` in the request body (along with other fields like `thirdPartyId`).

</TabItem>

</FrontendCustomUITabs>


<!-- COPY SECTION -->
<!-- ./thirdparty/pre-built-ui/multitenant-login.mdx  -->
<!-- 3 -->

## Step 3: Backend CORS changes

If you are using different domains or sub-domains for each tenant on the frontend, your backend CORS setting needs to be updated to allow requests from those origins.

<BackendSDKTabs>
<TabItem value="nodejs">

```tsx
TODO
```
</TabItem>
<TabItem value="go">

<GoFrameworkSubTabs>

<TabItem value="http">

```go
import (
	"net/http"
	"strings"

	"github.com/supertokens/supertokens-golang/supertokens"
)

func corsMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(response http.ResponseWriter, r *http.Request) {
		// highlight-start
		origin := r.Header.Get("Origin")
		if isAllowedOrigin(origin) {
			response.Header().Set("Access-Control-Allow-Origin", origin)
		}
		// highlight-end
		response.Header().Set("Access-Control-Allow-Credentials", "true")
		if r.Method == "OPTIONS" {
			// we add content-type + other headers used by SuperTokens
			response.Header().Set("Access-Control-Allow-Headers",
				strings.Join(append([]string{"Content-Type"},
					supertokens.GetAllCORSHeaders()...), ","))
			response.Header().Set("Access-Control-Allow-Methods", "*")
			response.Write([]byte(""))
		} else {
			next.ServeHTTP(response, r)
		}
	})
}

// highlight-start
func isAllowedOrigin(origin string) bool {
	// TODO: Return true if any of the tenants in your app use the input origin.
	return true
}
// highlight-end
```

</TabItem>

<TabItem value="chi">

```go
TODO
```

</TabItem>

<TabItem value="gin">

```go
TODO
```

</TabItem>

<TabItem value="mux">

```go
TODO
```

</TabItem>

</GoFrameworkSubTabs>

</TabItem>
<TabItem value="python">

```python
TODO
```

</TabItem>
</BackendSDKTabs>

<!-- END COPY SECTION -->

<!-- COPY SECTION -->
<!-- ./thirdparty/pre-built-ui/multitenant-login.mdx  -->
<!-- 4 -->

:::success
You have now completed a basic multi tenant setup for your application. There may be more steps required depending on the specifics of your UX. Checkout the "See also" section below for more information.
:::

## See also

- Multi tenant [single domain](../TODO) or [sub domain](../TODO) login.
- [Getting tenant id of logged in user](../TODO).
- [See all built in multitenant providers](../TODO).
- [See how to add custom multitenant provider](../TODO).
- [Allowing end users to add their own SSO provider](../TODO).
- [SAML login](../TODO).

<!-- END COPY SECTION -->
