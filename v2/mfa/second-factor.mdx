---
id: second-factor
title: "Setting up the second factor (backend)"
hide_title: true
---

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';
import NodeJSFrameworkSubTabsServerless from "/src/components/tabs/NodeJSFrameworkSubTabsServerless"
import GoFrameworkSubTabs from "/src/components/tabs/GoFrameworkSubTabs"
import PythonFrameworkSubTabs from "/src/components/tabs/PythonFrameworkSubTabs"
import BackendSDKCasing from "/src/components/BackendSDKCasing"
import AppInfoForm from "/src/components/appInfoForm"
import CoreInjector from "/src/components/coreInjector"

# Setting up the 2nd factor (backend)

## 1) Initialisation

We will be using the [Passwordless recipe](https://supertokens.com/docs/passwordless/introduction) with SMS OTP as the second factor. You can follow the recipe's [backend quick setup guide](https://supertokens.com/docs/passwordless/quick-setup/backend) to configure a different method as well (for example with email magic links).

The `Passwordless.init` function should look something like this:

<AppInfoForm
    askForAppName
    askForAPIDomain
    askForWebsiteDomain
>

<CoreInjector>

<BackendSDKTabs>
<TabItem value="nodejs">

<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyEmailPassword from"supertokens-node/recipe/thirdpartyemailpassword";
import Passwordless from "supertokens-node/recipe/passwordless"

supertokens.init({
    framework: "express",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/thirdpartyemailpassword/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        // highlight-start
        Passwordless.init({
            flowType: "USER_INPUT_CODE",
            contactMethod: "PHONE"
        }),
        // highlight-end
        ThirdPartyEmailPassword.init({/*...*/}),
        Session.init({/*Override from previous step*/})
    ]
});
```
</TabItem>

<TabItem value="hapi">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyEmailPassword from"supertokens-node/recipe/thirdpartyemailpassword";
import Passwordless from "supertokens-node/recipe/passwordless"

supertokens.init({
    framework: "hapi",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        // highlight-start
        Passwordless.init({
            flowType: "USER_INPUT_CODE",
            contactMethod: "PHONE"
        }),
        // highlight-end
        ThirdPartyEmailPassword.init({/*...*/}),
        Session.init({ /*Override from previous step*/ })
    ]
});
```
</TabItem>

<TabItem value="fastify">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyEmailPassword from"supertokens-node/recipe/thirdpartyemailpassword";
import Passwordless from "supertokens-node/recipe/passwordless"

supertokens.init({
    framework: "fastify",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        // highlight-start
        Passwordless.init({
            flowType: "USER_INPUT_CODE",
            contactMethod: "PHONE"
        }),
        // highlight-end
        ThirdPartyEmailPassword.init({/*...*/}),
        Session.init({/*Override from previous step*/})
    ]
});
```
</TabItem>

<TabItem value="koa">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyEmailPassword from"supertokens-node/recipe/thirdpartyemailpassword";
import Passwordless from "supertokens-node/recipe/passwordless"

supertokens.init({
    framework: "koa",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        // highlight-start
        Passwordless.init({
            flowType: "USER_INPUT_CODE",
            contactMethod: "PHONE"
        }),
        // highlight-end
        ThirdPartyEmailPassword.init({/*...*/}),
        Session.init({/*Override from previous step*/})
    ]
});
```
</TabItem>

<TabItem value="loopback">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyEmailPassword from"supertokens-node/recipe/thirdpartyemailpassword";
import Passwordless from "supertokens-node/recipe/passwordless"

supertokens.init({
    framework: "loopback",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        // highlight-start
        Passwordless.init({
            flowType: "USER_INPUT_CODE",
            contactMethod: "PHONE"
        }),
        // highlight-end
        ThirdPartyEmailPassword.init({/*...*/}),
        Session.init({/*Override from previous step*/})
    ]
});
```
</TabItem>
<TabItem value="serverless">

:::important
Please refer the **Serverless Deployment** section in the Passwordless recipe guide
:::

</TabItem>
<TabItem value="nextjs">

:::important
Please refer the **NextJS** section in the Passwordless recipe guide
:::

</TabItem>
<TabItem value="nestjs">

:::important
Please refer the **NestJS** section in the Passwordless recipe guide
:::

</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">

```go
import (
    "github.com/supertokens/supertokens-golang/recipe/passwordless"
	"github.com/supertokens/supertokens-golang/recipe/passwordless/plessmodels"
	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/recipe/session/sessmodels"
	"github.com/supertokens/supertokens-golang/recipe/thirdpartyemailpassword"
	"github.com/supertokens/supertokens-golang/recipe/thirdpartyemailpassword/tpepmodels"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    apiBasePath := "^{form_apiBasePath}"
    websiteBasePath := "^{form_websiteBasePath}"
	err := supertokens.Init(supertokens.TypeInput{
		Supertokens: &supertokens.ConnectionInfo{
            ^{coreInjector_connection_uri_comment}
            ConnectionURI: ^{coreInjector_uri}
            ^{coreInjector_api_key_commented}APIKey: ^{coreInjector_api_key},
		},
		AppInfo: supertokens.AppInfo{
            AppName: "^{form_appName}",
            APIDomain: "^{form_apiDomain}",
            WebsiteDomain: "^{form_websiteDomain}",
            APIBasePath: &apiBasePath,
            WebsiteBasePath: &websiteBasePath,
		},
		RecipeList: []supertokens.Recipe{
            // highlight-start
            passwordless.Init(plessmodels.TypeInput{
                FlowType: "USER_INPUT_CODE",
                ContactMethodPhone: plessmodels.ContactMethodPhoneConfig{
                    Enabled: true,
                },
            }),
            // highlight-end
			thirdpartyemailpassword.Init(&tpepmodels.TypeInput{/*...*/}),
			session.Init(&sessmodels.TypeInput{
				/*Override from previous step*/
			}),
		},
	})

	if err != nil {
		panic(err.Error())
	}
}
```
</TabItem>
<TabItem value="python">
<PythonFrameworkSubTabs>
<TabItem value="fastapi">

```python
from supertokens_python import init, InputAppInfo, SupertokensConfig
from supertokens_python.recipe import thirdpartyemailpassword, session, passwordless
from supertokens_python.recipe.passwordless import ContactPhoneOnlyConfig

init(
    app_info=InputAppInfo(
        app_name="^{form_appName}",
        api_domain="^{form_apiDomain}",
        website_domain="^{form_websiteDomain}",
        api_base_path="^{form_apiBasePath}",
        website_base_path="^{form_websiteBasePath}"
    ),
    supertokens_config=SupertokensConfig(
        ^{coreInjector_connection_uri_comment_with_hash}
        connection_uri=^{coreInjector_uri}
        ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
    ),
    framework='fastapi',
    recipe_list=[
	    session.init(), # contains the override from the previous step
        thirdpartyemailpassword.init(
           # ...
        ),
        # highlight-start
        passwordless.init(
            flow_type="USER_INPUT_CODE",
            contact_config=ContactPhoneOnlyConfig()
        )
        # highlight-end
    ],
    mode='asgi' # use wsgi if you are running using gunicorn
)
```

</TabItem>
<TabItem value="flask">

```python
from supertokens_python import init, InputAppInfo, SupertokensConfig
from supertokens_python.recipe import thirdpartyemailpassword, session, passwordless
from supertokens_python.recipe.passwordless import ContactPhoneOnlyConfig

init(
    app_info=InputAppInfo(
        app_name="^{form_appName}",
        api_domain="^{form_apiDomain}",
        website_domain="^{form_websiteDomain}",
        api_base_path="^{form_apiBasePath}",
        website_base_path="^{form_websiteBasePath}"
    ),
    supertokens_config=SupertokensConfig(
        ^{coreInjector_connection_uri_comment_with_hash}
        connection_uri=^{coreInjector_uri}
        ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
    ),
    framework='flask',
    recipe_list=[
	    session.init(), # contains the override from the previous step
        thirdpartyemailpassword.init(
           # ...
        ),
        # highlight-start
        passwordless.init(
            flow_type="USER_INPUT_CODE",
            contact_config=ContactPhoneOnlyConfig()
        )
        # highlight-end
    ]
)
```

</TabItem>
<TabItem value="django">

```python
from supertokens_python import init, InputAppInfo, SupertokensConfig
from supertokens_python.recipe import thirdpartyemailpassword, session, passwordless
from supertokens_python.recipe.passwordless import ContactPhoneOnlyConfig

init(
    app_info=InputAppInfo(
        app_name="^{form_appName}",
        api_domain="^{form_apiDomain}",
        website_domain="^{form_websiteDomain}",
        api_base_path="^{form_apiBasePath}",
        website_base_path="^{form_websiteBasePath}"
    ),
    supertokens_config=SupertokensConfig(
        ^{coreInjector_connection_uri_comment_with_hash}
        connection_uri=^{coreInjector_uri}
        ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
    ),
    framework='django',
    recipe_list=[
	    session.init(), # contains the override from the previous step
        thirdpartyemailpassword.init(
           # ...
        ),
        # highlight-start
        passwordless.init(
            flow_type="USER_INPUT_CODE",
            contact_config=ContactPhoneOnlyConfig()
        )
        # highlight-end
    ],
    mode='asgi' # use wsgi if you are running django server in sync mode
)
```

</TabItem>
</PythonFrameworkSubTabs>
</TabItem>
</BackendSDKTabs>
</CoreInjector>
</AppInfoForm>


## 2) Verifying the phone number that the OTP is being sent to

In our example app, the first step in the second factor is to send an SMS OTP to the user. This happens when the `createCodePOST` API, from the Passwordless recipe, is called.

There are two cases here:
- During user sign up: This is when the user has entered the phone number from the frontend for the first time. Here, we can trust this phone number. After verification, we will save this phone number against the user's profile.
- During user sign in: This is when the frontend has picked up the phone number from the session and called this API automatically (without asking the user to re enter their phone number). Since this is coming from the frontend, we cannot trust it blindly and have to verify that this phone number is indeed the same one that the user had associated with their profile during sign up.