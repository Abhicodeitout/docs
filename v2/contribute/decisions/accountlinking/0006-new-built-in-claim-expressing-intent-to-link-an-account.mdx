---
id: "0006"
title: New built in claim expressing intent to link an account
hide_title: true
---

import DecisionHeader from "/src/components/decisionLogs/DecisionHeader"
import ArgumentPro from "/src/components/decisionLogs/ArgumentPro"
import ArgumentCon from "/src/components/decisionLogs/ArgumentCon"
import ArgumentNeut from "/src/components/decisionLogs/ArgumentNeut"

# New built in claim expressing intent to link an account

<DecisionHeader status="accepted" lastUpdate="2022-12-01" created="2022-11-30" deciders={["rishabhpoddar", "bhumilsarvaiya"]} proposedBy={["rishabhpoddar"]} />

## Context and Problem Statement

We need to verify email B even if logged in using email A, cause post login account linking may require you to verify email B in order to link it. For this to happen, we need a way for email verification related UI and APIs to know about email B

## Considered Options

* update accessToken payload email verification claim to have additional information regarding email B (email for which email verification needs to be done)


## Discussion

* We would add this claim in APIs that initiate a new sign up. For example in the passwordless createCodePOST API, we can add this claim if a session already exists when this API is called. Or in linkAccountToExistingAccountPOST API for social login (containing the provider’s auth code).
* New payload structure:
```ts
{
   "st-acc-link":{
      v: <recipe user ID> | "not created",
      t: ....,
   }
}
```
* The v will be “not created” if this claim is being added in APIs like createCodePOST. Else it will be the recipeUserId of the new user.
* The email verification UI on the frontend and related APIs (create and consume verification code + is email verified API), check this claim if the normal email verification claim is true. If this claim exists, and has a user ID, then it will use that for its operations.
* The implies that the user will still be able to use their app routes and app’s APIs even if the new account to link is kept in unverified mode.